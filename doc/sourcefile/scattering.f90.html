<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   <meta name="description" content="BIGOS – Binary Inelastic scattering and Generalized Optical cross Section package, vs. 0.01">
    <meta name="author" content="Hubert Jóźwiak" >
    <link rel="icon" href="../favicon.png">

    <title>scattering.f90 &ndash; the SCATTERING code</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">the SCATTERING code </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href='../page/index.html'>Program Description</a></li>
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
            <li><a href="../lists/files.html">Source Files</a></li>
            <li><a href="../lists/modules.html">Modules</a></li>
            <li><a href="../lists/procedures.html">Procedures</a></li>
                   <li><a href="../program/scattering.html">Program</a></li>
       
            </ul>
        
            </li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>
                             <li class="visible-xs hidden-sm visible-lg"><a href="../program/scattering.html">Program</a></li>
          </ul>
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
  <div class="row">
    <h1>scattering.f90
      <small>Source File</small>
      
    </h1>
      <div class="row" id="info-bar">
    <div class="col-lg-12">
      <div class="well well-sm">
        <ul class="list-inline" style="margin-bottom:0px;display:inline">

          <li id="statements"><i class="fa fa-list-ol"></i>
            <a data-toggle="tooltip"
               data-placement="bottom" data-html="true"
               title=" 4.7% of total for source files.">138 statements</a>
          </li>

            <li id="source-file">
              <i class="fa fa-code"></i>
              <a href="../src/scattering.f90"> Source File</a>
            </li>
        </ul>
        <ol class="breadcrumb in-well text-right">
          <li class="active">scattering.f90</li>
        </ol>
      </div>
    </div>
  </div>
  <script>
    $(function () {
    $('[data-toggle="tooltip"]').tooltip()
    })
  </script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
      <div id="sidebar">
      <h3>Contents</h3>
  
  
  
  
      <div class="panel panel-primary">
      <div class="panel-heading text-left">
        <h3 class="panel-title">
          <a data-toggle="collapse" href="#progs-0">Programs</a>
        </h3>
      </div>
      <div id="progs-0" class="panel-collapse collapse">
        <div class="list-group">
            <a class="list-group-item" href="../program/scattering.html">SCATTERING</a>
        </div>
      </div>
    </div>

  
  
  
  
  
  
  
  
  
  
  
  
  
  
    <div class="panel panel-primary">
      <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
      <div class="list-group">
        <a class="list-group-item" href="../sourcefile/scattering.f90.html#src">scattering.f90</a>
      </div>
    </div>


  </div>

    </div>
    <div class="col-md-9" id='text'>
      
      <br>
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: sourcefile~~scattering.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefilescatteringf90EfferentGraph" width="641pt" height="312pt"
 viewBox="0.00 0.00 641.00 311.99" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~scattering.f90~~EfferentGraph" class="graph" transform="scale(1.89 1.89) rotate(0) translate(4 585.9)">
<title>sourcefile~~scattering.f90~~EfferentGraph</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-585.9 1208,-585.9 1208,4 -4,4"/>
<!-- sourcefile~scattering.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~scattering.f90</title>
<polygon fill="none" stroke="black" points="1204,-151.29 1118,-151.29 1118,-127.29 1204,-127.29 1204,-151.29"/>
<text text-anchor="middle" x="1161" y="-136.89" font-family="Helvetica,sans-Serif" font-size="10.50">scattering.f90</text>
</g>
<!-- sourcefile~save_s_matrix_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~save_s_matrix_mod.f90</title>
<g id="a_sourcefile~~scattering.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/save_s_matrix_mod.f90.html" xlink:title="save_s_matrix_mod.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="326.5,-453.29 189.5,-453.29 189.5,-429.29 326.5,-429.29 326.5,-453.29"/>
<text text-anchor="middle" x="258" y="-438.89" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">save_s_matrix_mod.f90</text>
</a>
</g>
</g>
<!-- sourcefile~scattering.f90&#45;&gt;sourcefile~save_s_matrix_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~scattering.f90&#45;&gt;sourcefile~save_s_matrix_mod.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M863.5,-485.29C725.19,-470.07 689.77,-476.45 551,-466.29 478.21,-460.96 395.31,-453.76 336.48,-448.45"/>
<polygon fill="#ff0000" stroke="#ff0000" points="336.8,-444.96 326.52,-447.55 336.17,-451.93 336.8,-444.96"/>
</g>
<!-- sourcefile~unitarity_check_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~unitarity_check_mod.f90</title>
<g id="a_sourcefile~~scattering.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/unitarity_check_mod.f90.html" xlink:title="unitarity_check_mod.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="329.5,-533.29 186.5,-533.29 186.5,-509.29 329.5,-509.29 329.5,-533.29"/>
<text text-anchor="middle" x="258" y="-518.89" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">unitarity_check_mod.f90</text>
</a>
</g>
</g>
<!-- sourcefile~scattering.f90&#45;&gt;sourcefile~unitarity_check_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~scattering.f90&#45;&gt;sourcefile~unitarity_check_mod.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1020.5,-485.29C803.43,-625.54 702.06,-575.2 444,-561.29"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M442,-561.29C396.54,-557.37 345.94,-545.73 309.49,-536.01"/>
<polygon fill="#ff0000" stroke="#ff0000" points="310.17,-532.57 299.6,-533.33 308.34,-539.32 310.17,-532.57"/>
</g>
<!-- sourcefile~input_reader_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_node4" class="node">
<title>sourcefile~input_reader_mod.f90</title>
<g id="a_sourcefile~~scattering.f90~~EfferentGraph_node4"><a xlink:href=".././sourcefile/input_reader_mod.f90.html" xlink:title="input_reader_mod.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="508,-343.29 378,-343.29 378,-319.29 508,-319.29 508,-343.29"/>
<text text-anchor="middle" x="443" y="-328.89" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">input_reader_mod.f90</text>
</a>
</g>
</g>
<!-- sourcefile~scattering.f90&#45;&gt;sourcefile~input_reader_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge3" class="edge">
<title>sourcefile~scattering.f90&#45;&gt;sourcefile~input_reader_mod.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1160.14,-151.43C1159.99,-204.92 1151.24,-419.73 1022.5,-485.29"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1020.5,-485.29C959.66,-516.27 831.13,-336.28 768,-310.29 723.13,-291.82 707.93,-281.06 660.5,-291.29"/>
</g>
<!-- sourcefile~data_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_node5" class="node">
<title>sourcefile~data_mod.f90</title>
<g id="a_sourcefile~~scattering.f90~~EfferentGraph_node5"><a xlink:href=".././sourcefile/data_mod.f90.html" xlink:title="data_mod.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="115.5,-473.29 29.5,-473.29 29.5,-449.29 115.5,-449.29 115.5,-473.29"/>
<text text-anchor="middle" x="72.5" y="-458.89" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">data_mod.f90</text>
</a>
</g>
</g>
<!-- sourcefile~scattering.f90&#45;&gt;sourcefile~data_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge4" class="edge">
<title>sourcefile~scattering.f90&#45;&gt;sourcefile~data_mod.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M442,-561.29C360.97,-554.29 339.8,-570.57 259,-561.29"/>
</g>
<!-- sourcefile~state_to_state_cross_sections_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_node6" class="node">
<title>sourcefile~state_to_state_cross_sections_mod.f90</title>
<g id="a_sourcefile~~scattering.f90~~EfferentGraph_node6"><a xlink:href=".././sourcefile/state_to_state_cross_sections_mod.f90.html" xlink:title="state_to_state_cross_sections_mod.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="768,-457.29 551,-457.29 551,-433.29 768,-433.29 768,-457.29"/>
<text text-anchor="middle" x="659.5" y="-442.89" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">state_to_state_cross_sections_mod.f90</text>
</a>
</g>
</g>
<!-- sourcefile~scattering.f90&#45;&gt;sourcefile~state_to_state_cross_sections_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge5" class="edge">
<title>sourcefile~scattering.f90&#45;&gt;sourcefile~state_to_state_cross_sections_mod.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M863.5,-485.29C814.46,-479.89 759.6,-468.77 719.29,-459.62"/>
<polygon fill="#ff0000" stroke="#ff0000" points="719.89,-456.17 709.36,-457.35 718.33,-462.99 719.89,-456.17"/>
</g>
<!-- sourcefile~utility_functions_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_node7" class="node">
<title>sourcefile~utility_functions_mod.f90</title>
<g id="a_sourcefile~~scattering.f90~~EfferentGraph_node7"><a xlink:href=".././sourcefile/utility_functions_mod.f90.html" xlink:title="utility_functions_mod.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="145,-373.29 0,-373.29 0,-349.29 145,-349.29 145,-373.29"/>
<text text-anchor="middle" x="72.5" y="-358.89" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">utility_functions_mod.f90</text>
</a>
</g>
</g>
<!-- sourcefile~scattering.f90&#45;&gt;sourcefile~utility_functions_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge6" class="edge">
<title>sourcefile~scattering.f90&#45;&gt;sourcefile~utility_functions_mod.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1134.03,-127.27C1106.86,-115.77 1062.64,-100.05 1022.5,-99.29"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1020.5,-99.29C951.62,-97.99 932.33,-116.01 865.5,-99.29"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M863.5,-99.29C814.87,-87.13 816.17,-53.17 768,-39.29 549.21,23.74 457.54,14.17 259,-97.29"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M257,-97.29C226.64,-114.33 207.6,-93.83 181,-116.29 110.37,-175.92 84.59,-290.89 76.61,-339.13"/>
<polygon fill="#ff0000" stroke="#ff0000" points="73.13,-338.71 75.06,-349.13 80.05,-339.79 73.13,-338.71"/>
</g>
<!-- sourcefile~propagator_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_node8" class="node">
<title>sourcefile~propagator_mod.f90</title>
<g id="a_sourcefile~~scattering.f90~~EfferentGraph_node8"><a xlink:href=".././sourcefile/propagator_mod.f90.html" xlink:title="propagator_mod.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="1082,-151.29 961,-151.29 961,-127.29 1082,-127.29 1082,-151.29"/>
<text text-anchor="middle" x="1021.5" y="-136.89" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">propagator_mod.f90</text>
</a>
</g>
</g>
<!-- sourcefile~scattering.f90&#45;&gt;sourcefile~propagator_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge7" class="edge">
<title>sourcefile~scattering.f90&#45;&gt;sourcefile~propagator_mod.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1118,-139.29C1109.88,-139.29 1101.17,-139.29 1092.44,-139.29"/>
<polygon fill="#ff0000" stroke="#ff0000" points="1092.21,-135.79 1082.21,-139.29 1092.21,-142.79 1092.21,-135.79"/>
</g>
<!-- sourcefile~radial_coupling_terms_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_node9" class="node">
<title>sourcefile~radial_coupling_terms_mod.f90</title>
<g id="a_sourcefile~~scattering.f90~~EfferentGraph_node9"><a xlink:href=".././sourcefile/radial_coupling_terms_mod.f90.html" xlink:title="radial_coupling_terms_mod.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="749.5,-149.29 569.5,-149.29 569.5,-125.29 749.5,-125.29 749.5,-149.29"/>
<text text-anchor="middle" x="659.5" y="-134.89" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">radial_coupling_terms_mod.f90</text>
</a>
</g>
</g>
<!-- sourcefile~scattering.f90&#45;&gt;sourcefile~radial_coupling_terms_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge8" class="edge">
<title>sourcefile~scattering.f90&#45;&gt;sourcefile~radial_coupling_terms_mod.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M863.5,-137.29C829.78,-140.32 792.78,-141.07 759.72,-140.83"/>
<polygon fill="#ff0000" stroke="#ff0000" points="759.62,-137.33 749.59,-140.73 759.55,-144.33 759.62,-137.33"/>
</g>
<!-- sourcefile~pes_matrix_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_node10" class="node">
<title>sourcefile~pes_matrix_mod.f90</title>
<g id="a_sourcefile~~scattering.f90~~EfferentGraph_node10"><a xlink:href=".././sourcefile/pes_matrix_mod.f90.html" xlink:title="pes_matrix_mod.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="925,-189.29 804,-189.29 804,-165.29 925,-165.29 925,-189.29"/>
<text text-anchor="middle" x="864.5" y="-174.89" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">pes_matrix_mod.f90</text>
</a>
</g>
</g>
<!-- sourcefile~scattering.f90&#45;&gt;sourcefile~pes_matrix_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge9" class="edge">
<title>sourcefile~scattering.f90&#45;&gt;sourcefile~pes_matrix_mod.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1020.5,-99.29C992.74,-98.77 985.01,-104.36 961,-118.29 942.22,-129.18 943.19,-139.45 925,-151.29 919.61,-154.8 913.66,-158.04 907.67,-160.95"/>
<polygon fill="#ff0000" stroke="#ff0000" points="905.93,-157.9 898.31,-165.25 908.86,-164.26 905.93,-157.9"/>
</g>
<!-- sourcefile~array_operations_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_node11" class="node">
<title>sourcefile~array_operations_mod.f90</title>
<g id="a_sourcefile~~scattering.f90~~EfferentGraph_node11"><a xlink:href=".././sourcefile/array_operations_mod.f90.html" xlink:title="array_operations_mod.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="334.5,-267.29 181.5,-267.29 181.5,-243.29 334.5,-243.29 334.5,-267.29"/>
<text text-anchor="middle" x="258" y="-252.89" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">array_operations_mod.f90</text>
</a>
</g>
</g>
<!-- sourcefile~scattering.f90&#45;&gt;sourcefile~array_operations_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge10" class="edge">
<title>sourcefile~scattering.f90&#45;&gt;sourcefile~array_operations_mod.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1020.5,-99.29C949.58,-97.95 936.15,-130.95 865.5,-137.29"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M863.5,-137.29C835.1,-139.84 828.47,-127.93 804,-113.29 786.13,-102.6 787.58,-90.38 768,-83.29 601.52,-23.02 523.14,-25.73 371,-116.29 364.59,-120.11 304.45,-196.83 275.04,-234.62"/>
<polygon fill="#ff0000" stroke="#ff0000" points="271.98,-232.85 268.61,-242.9 277.51,-237.15 271.98,-232.85"/>
</g>
<!-- sourcefile~boundary_conditions_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_node12" class="node">
<title>sourcefile~boundary_conditions_mod.f90</title>
<g id="a_sourcefile~~scattering.f90~~EfferentGraph_node12"><a xlink:href=".././sourcefile/boundary_conditions_mod.f90.html" xlink:title="boundary_conditions_mod.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="746,-191.29 573,-191.29 573,-167.29 746,-167.29 746,-191.29"/>
<text text-anchor="middle" x="659.5" y="-176.89" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">boundary_conditions_mod.f90</text>
</a>
</g>
</g>
<!-- sourcefile~scattering.f90&#45;&gt;sourcefile~boundary_conditions_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge11" class="edge">
<title>sourcefile~scattering.f90&#45;&gt;sourcefile~boundary_conditions_mod.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M863.5,-137.29C820.22,-141.18 810.55,-149.46 768,-158.29 756.84,-160.61 745.01,-162.99 733.44,-165.28"/>
<polygon fill="#ff0000" stroke="#ff0000" points="732.5,-161.9 723.36,-167.27 733.85,-168.77 732.5,-161.9"/>
</g>
<!-- sourcefile~channels_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_node13" class="node">
<title>sourcefile~channels_mod.f90</title>
<g id="a_sourcefile~~scattering.f90~~EfferentGraph_node13"><a xlink:href=".././sourcefile/channels_mod.f90.html" xlink:title="channels_mod.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="714.5,-400.29 604.5,-400.29 604.5,-376.29 714.5,-376.29 714.5,-400.29"/>
<text text-anchor="middle" x="659.5" y="-385.89" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">channels_mod.f90</text>
</a>
</g>
</g>
<!-- sourcefile~scattering.f90&#45;&gt;sourcefile~channels_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge12" class="edge">
<title>sourcefile~scattering.f90&#45;&gt;sourcefile~channels_mod.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M1020.5,-485.29C959.11,-516.55 933.98,-492.83 865.5,-485.29"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M863.5,-485.29C813.44,-479.78 813.44,-446.01 768,-424.29 750.92,-416.13 731.5,-409.02 713.91,-403.32"/>
<polygon fill="#ff0000" stroke="#ff0000" points="714.94,-399.98 704.35,-400.3 712.83,-406.65 714.94,-399.98"/>
</g>
<!-- sourcefile~save_s_matrix_mod.f90&#45;&gt;sourcefile~data_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge13" class="edge">
<title>sourcefile~save_s_matrix_mod.f90&#45;&gt;sourcefile~data_mod.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M189.45,-448.65C168.39,-450.95 145.5,-453.44 125.67,-455.61"/>
<polygon fill="#ff0000" stroke="#ff0000" points="125.16,-452.14 115.6,-456.7 125.92,-459.1 125.16,-452.14"/>
</g>
<!-- sourcefile~save_s_matrix_mod.f90&#45;&gt;sourcefile~utility_functions_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge14" class="edge">
<title>sourcefile~save_s_matrix_mod.f90&#45;&gt;sourcefile~utility_functions_mod.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M218.35,-429.2C206.26,-425.12 192.96,-420.31 181,-415.29 154.5,-404.16 125.42,-389.39 104.2,-378.11"/>
<polygon fill="#ff0000" stroke="#ff0000" points="105.79,-374.99 95.32,-373.36 102.48,-381.16 105.79,-374.99"/>
</g>
<!-- sourcefile~unitarity_check_mod.f90&#45;&gt;sourcefile~data_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge15" class="edge">
<title>sourcefile~unitarity_check_mod.f90&#45;&gt;sourcefile~data_mod.f90</title>
<path fill="none" stroke="#ff7f00" stroke-dasharray="5,2" d="M219.87,-509.15C191.04,-499.72 150.92,-486.6 119.97,-476.48"/>
<polygon fill="#ff7f00" stroke="#ff7f00" points="120.86,-473.09 110.27,-473.31 118.68,-479.75 120.86,-473.09"/>
</g>
<!-- sourcefile~unitarity_check_mod.f90&#45;&gt;sourcefile~utility_functions_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge16" class="edge">
<title>sourcefile~unitarity_check_mod.f90&#45;&gt;sourcefile~utility_functions_mod.f90</title>
<path fill="none" stroke="#ff7f00" stroke-dasharray="5,2" d="M240.64,-509.29C225,-497.66 200.94,-479.33 181,-462.29 149.1,-435.03 113.99,-401.28 92.85,-380.52"/>
<polygon fill="#ff7f00" stroke="#ff7f00" points="95.31,-378.03 85.73,-373.5 90.39,-383.01 95.31,-378.03"/>
</g>
<!-- sourcefile~input_reader_mod.f90&#45;&gt;sourcefile~data_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge20" class="edge">
<title>sourcefile~input_reader_mod.f90&#45;&gt;sourcefile~data_mod.f90</title>
<path fill="none" stroke="#ffff00" stroke-dasharray="5,2" d="M435.57,-343.62C421.25,-369.81 384.09,-431.14 335,-462.29 305.6,-480.95 292.07,-470.41 259,-481.29"/>
</g>
<!-- sourcefile~input_reader_mod.f90&#45;&gt;sourcefile~utility_functions_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge17" class="edge">
<title>sourcefile~input_reader_mod.f90&#45;&gt;sourcefile~utility_functions_mod.f90</title>
<path fill="none" stroke="#ffff00" stroke-dasharray="5,2" d="M377.67,-325.24C342.61,-322.59 298.44,-320.27 259,-321.29"/>
<path fill="none" stroke="#ffff00" stroke-dasharray="5,2" d="M257,-321.29C209.33,-322.52 156.24,-335.4 119.48,-346.22"/>
<polygon fill="#ffff00" stroke="#ffff00" points="118.13,-342.97 109.56,-349.2 120.14,-349.67 118.13,-342.97"/>
</g>
<!-- sourcefile~input_reader_mod.f90&#45;&gt;sourcefile~array_operations_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge18" class="edge">
<title>sourcefile~input_reader_mod.f90&#45;&gt;sourcefile~array_operations_mod.f90</title>
<path fill="none" stroke="#ffff00" stroke-dasharray="5,2" d="M413,-319.25C381.77,-306.28 331.94,-285.58 297.45,-271.26"/>
<polygon fill="#ffff00" stroke="#ffff00" points="298.74,-268.01 288.16,-267.4 296.06,-274.47 298.74,-268.01"/>
</g>
<!-- sourcefile~input_validation_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_node14" class="node">
<title>sourcefile~input_validation_mod.f90</title>
<g id="a_sourcefile~~scattering.f90~~EfferentGraph_node14"><a xlink:href=".././sourcefile/input_validation_mod.f90.html" xlink:title="input_validation_mod.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="331.5,-373.29 184.5,-373.29 184.5,-349.29 331.5,-349.29 331.5,-373.29"/>
<text text-anchor="middle" x="258" y="-358.89" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">input_validation_mod.f90</text>
</a>
</g>
</g>
<!-- sourcefile~input_reader_mod.f90&#45;&gt;sourcefile~input_validation_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge19" class="edge">
<title>sourcefile~input_reader_mod.f90&#45;&gt;sourcefile~input_validation_mod.f90</title>
<path fill="none" stroke="#ffff00" stroke-dasharray="5,2" d="M378,-341.78C366.32,-343.7 353.99,-345.72 341.86,-347.71"/>
<polygon fill="#ffff00" stroke="#ffff00" points="341.04,-344.3 331.73,-349.37 342.17,-351.2 341.04,-344.3"/>
</g>
<!-- sourcefile~state_to_state_cross_sections_mod.f90&#45;&gt;sourcefile~input_reader_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge23" class="edge">
<title>sourcefile~state_to_state_cross_sections_mod.f90&#45;&gt;sourcefile~input_reader_mod.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M612.52,-433.29C593,-427.34 570.33,-419.27 551,-409.29 519.04,-392.79 486.18,-367.33 465.46,-350.02"/>
<polygon fill="#00ff00" stroke="#00ff00" points="467.51,-347.17 457.62,-343.37 462.99,-352.51 467.51,-347.17"/>
</g>
<!-- sourcefile~state_to_state_cross_sections_mod.f90&#45;&gt;sourcefile~data_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge21" class="edge">
<title>sourcefile~state_to_state_cross_sections_mod.f90&#45;&gt;sourcefile~data_mod.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M630.22,-457.41C589.67,-474.37 512.36,-505.12 444,-523.29"/>
</g>
<!-- sourcefile~state_to_state_cross_sections_mod.f90&#45;&gt;sourcefile~utility_functions_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge22" class="edge">
<title>sourcefile~state_to_state_cross_sections_mod.f90&#45;&gt;sourcefile~utility_functions_mod.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M552.96,-433.26C456.02,-421.77 308.5,-403.13 181,-382.29 168.21,-380.2 154.62,-377.74 141.55,-375.24"/>
<polygon fill="#00ff00" stroke="#00ff00" points="142.17,-371.8 131.68,-373.34 140.84,-378.67 142.17,-371.8"/>
</g>
<!-- sourcefile~propagator_mod.f90&#45;&gt;sourcefile~input_reader_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge25" class="edge">
<title>sourcefile~propagator_mod.f90&#45;&gt;sourcefile~input_reader_mod.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M863.5,-253.29C777.6,-285.65 750.22,-271.93 660.5,-291.29"/>
</g>
<!-- sourcefile~propagator_mod.f90&#45;&gt;sourcefile~data_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge24" class="edge">
<title>sourcefile~propagator_mod.f90&#45;&gt;sourcefile~data_mod.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M1019.13,-151.4C1012.38,-208.76 980.72,-452.27 925,-499.29 834.79,-575.42 771.36,-482.76 660.5,-523.29"/>
</g>
<!-- sourcefile~propagator_mod.f90&#45;&gt;sourcefile~utility_functions_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge26" class="edge">
<title>sourcefile~propagator_mod.f90&#45;&gt;sourcefile~utility_functions_mod.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M974.43,-127.21C943.62,-119.18 902.17,-108.46 865.5,-99.29"/>
</g>
<!-- sourcefile~propagator_mod.f90&#45;&gt;sourcefile~pes_matrix_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge29" class="edge">
<title>sourcefile~propagator_mod.f90&#45;&gt;sourcefile~pes_matrix_mod.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M971.46,-151.31C956.54,-154.97 939.99,-159.03 924.5,-162.83"/>
<polygon fill="#00ffff" stroke="#00ffff" points="923.37,-159.5 914.49,-165.28 925.04,-166.3 923.37,-159.5"/>
</g>
<!-- sourcefile~propagator_mod.f90&#45;&gt;sourcefile~array_operations_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge27" class="edge">
<title>sourcefile~propagator_mod.f90&#45;&gt;sourcefile~array_operations_mod.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M1009.04,-151.34C985.08,-175.65 926.77,-230.21 865.5,-253.29"/>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M863.5,-253.29C779.07,-285.09 750.34,-245.03 660.5,-253.29"/>
</g>
<!-- sourcefile~centrifugal_matrix_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_node15" class="node">
<title>sourcefile~centrifugal_matrix_mod.f90</title>
<g id="a_sourcefile~~scattering.f90~~EfferentGraph_node15"><a xlink:href=".././sourcefile/centrifugal_matrix_mod.f90.html" xlink:title="centrifugal_matrix_mod.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="739.5,-343.29 579.5,-343.29 579.5,-319.29 739.5,-319.29 739.5,-343.29"/>
<text text-anchor="middle" x="659.5" y="-328.89" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">centrifugal_matrix_mod.f90</text>
</a>
</g>
</g>
<!-- sourcefile~propagator_mod.f90&#45;&gt;sourcefile~centrifugal_matrix_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge28" class="edge">
<title>sourcefile~propagator_mod.f90&#45;&gt;sourcefile~centrifugal_matrix_mod.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M1015.07,-151.37C1002.89,-177.01 970.81,-237.04 925,-267.29 872.85,-301.73 803.98,-317.66 749.59,-325.02"/>
<polygon fill="#00ffff" stroke="#00ffff" points="749.09,-321.56 739.61,-326.3 749.98,-328.5 749.09,-321.56"/>
</g>
<!-- sourcefile~radial_coupling_terms_mod.f90&#45;&gt;sourcefile~input_reader_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge32" class="edge">
<title>sourcefile~radial_coupling_terms_mod.f90&#45;&gt;sourcefile~input_reader_mod.f90</title>
<path fill="none" stroke="#007fff" stroke-dasharray="5,2" d="M569.46,-146.53C562.76,-149.59 556.49,-153.45 551,-158.29 512.72,-192.02 542.88,-224.56 515,-267.29 503.33,-285.18 485.44,-301.26 470.54,-312.83"/>
<polygon fill="#007fff" stroke="#007fff" points="468.08,-310.3 462.18,-319.1 472.28,-315.9 468.08,-310.3"/>
</g>
<!-- sourcefile~radial_coupling_terms_mod.f90&#45;&gt;sourcefile~data_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge30" class="edge">
<title>sourcefile~radial_coupling_terms_mod.f90&#45;&gt;sourcefile~data_mod.f90</title>
<path fill="none" stroke="#007fff" stroke-dasharray="5,2" d="M574.92,-149.31C445.67,-168.62 209.14,-207.15 181,-234.29 132.28,-281.29 176.69,-322.47 145,-382.29 132.69,-405.54 111.99,-427.34 96.02,-442.12"/>
<polygon fill="#007fff" stroke="#007fff" points="93.27,-439.89 88.17,-449.18 97.95,-445.1 93.27,-439.89"/>
</g>
<!-- sourcefile~radial_coupling_terms_mod.f90&#45;&gt;sourcefile~utility_functions_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge31" class="edge">
<title>sourcefile~radial_coupling_terms_mod.f90&#45;&gt;sourcefile~utility_functions_mod.f90</title>
<path fill="none" stroke="#007fff" stroke-dasharray="5,2" d="M603.4,-125.22C550.49,-113.96 474.27,-98.69 444,-97.29"/>
</g>
<!-- sourcefile~math_functions_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_node16" class="node">
<title>sourcefile~math_functions_mod.f90</title>
<g id="a_sourcefile~~scattering.f90~~EfferentGraph_node16"><a xlink:href=".././sourcefile/math_functions_mod.f90.html" xlink:title="math_functions_mod.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="515,-149.29 371,-149.29 371,-125.29 515,-125.29 515,-149.29"/>
<text text-anchor="middle" x="443" y="-134.89" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">math_functions_mod.f90</text>
</a>
</g>
</g>
<!-- sourcefile~radial_coupling_terms_mod.f90&#45;&gt;sourcefile~math_functions_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge33" class="edge">
<title>sourcefile~radial_coupling_terms_mod.f90&#45;&gt;sourcefile~math_functions_mod.f90</title>
<path fill="none" stroke="#007fff" stroke-dasharray="5,2" d="M569.4,-137.29C554.85,-137.29 539.85,-137.29 525.51,-137.29"/>
<polygon fill="#007fff" stroke="#007fff" points="525.19,-133.79 515.19,-137.29 525.19,-140.79 525.19,-133.79"/>
</g>
<!-- sourcefile~pes_matrix_mod.f90&#45;&gt;sourcefile~input_reader_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge35" class="edge">
<title>sourcefile~pes_matrix_mod.f90&#45;&gt;sourcefile~input_reader_mod.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M852.2,-189.43C831.38,-211.54 787.32,-257.04 768,-267.29 724.75,-290.23 708.35,-280.97 660.5,-291.29"/>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M658.5,-291.29C611.07,-301.52 598.7,-301.4 551,-310.29 539.15,-312.5 526.58,-314.91 514.37,-317.28"/>
<polygon fill="#0000ff" stroke="#0000ff" points="513.37,-313.91 504.23,-319.26 514.71,-320.78 513.37,-313.91"/>
</g>
<!-- sourcefile~pes_matrix_mod.f90&#45;&gt;sourcefile~data_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge36" class="edge">
<title>sourcefile~pes_matrix_mod.f90&#45;&gt;sourcefile~data_mod.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M847.29,-189.4C833.42,-200.7 814.15,-218.85 804,-239.29 758.55,-330.77 827.37,-383.17 768,-466.29 736.57,-510.3 711.29,-504.72 660.5,-523.29"/>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M658.5,-523.29C568.96,-556.02 536.14,-498.81 444,-523.29"/>
</g>
<!-- sourcefile~pes_matrix_mod.f90&#45;&gt;sourcefile~utility_functions_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge34" class="edge">
<title>sourcefile~pes_matrix_mod.f90&#45;&gt;sourcefile~utility_functions_mod.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M830.28,-165.28C821.4,-161.41 812.05,-156.7 804,-151.29 785.48,-138.84 787.86,-126.46 768,-116.29 724.81,-94.18 708.54,-104.06 660.5,-97.29"/>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M658.5,-97.29C564.1,-83.99 539.23,-101.68 444,-97.29"/>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M442,-97.29C360.75,-93.55 329.92,-57.48 259,-97.29"/>
</g>
<!-- sourcefile~pes_matrix_mod.f90&#45;&gt;sourcefile~radial_coupling_terms_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge38" class="edge">
<title>sourcefile~pes_matrix_mod.f90&#45;&gt;sourcefile~radial_coupling_terms_mod.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M803.9,-165.4C792.01,-163.04 779.61,-160.58 768,-158.29 756.41,-156.01 744.12,-153.59 732.15,-151.25"/>
<polygon fill="#0000ff" stroke="#0000ff" points="732.67,-147.79 722.19,-149.3 731.33,-154.66 732.67,-147.79"/>
</g>
<!-- sourcefile~pes_matrix_mod.f90&#45;&gt;sourcefile~array_operations_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge39" class="edge">
<title>sourcefile~pes_matrix_mod.f90&#45;&gt;sourcefile~array_operations_mod.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M842.77,-189.32C807,-209.07 730.76,-246.83 660.5,-253.29"/>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M658.5,-253.29C563.57,-262.02 539,-261.26 444,-253.29"/>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M442,-253.29C410.43,-250.64 375.68,-250.36 345.03,-251"/>
<polygon fill="#0000ff" stroke="#0000ff" points="344.71,-247.51 334.8,-251.25 344.88,-254.51 344.71,-247.51"/>
</g>
<!-- sourcefile~pes_matrix_mod.f90&#45;&gt;sourcefile~math_functions_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge37" class="edge">
<title>sourcefile~pes_matrix_mod.f90&#45;&gt;sourcefile~math_functions_mod.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M658.5,-97.29C597.25,-88.66 526.87,-107.31 483.93,-121.95"/>
<polygon fill="#0000ff" stroke="#0000ff" points="482.69,-118.68 474.41,-125.29 485,-125.29 482.69,-118.68"/>
</g>
<!-- sourcefile~boundary_conditions_mod.f90&#45;&gt;sourcefile~input_reader_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge42" class="edge">
<title>sourcefile~boundary_conditions_mod.f90&#45;&gt;sourcefile~input_reader_mod.f90</title>
<path fill="none" stroke="#ff00ff" stroke-dasharray="5,2" d="M644.94,-191.71C612.03,-221.77 529.54,-296.66 515,-305.29 508.64,-309.07 501.63,-312.44 494.58,-315.41"/>
<polygon fill="#ff00ff" stroke="#ff00ff" points="493,-312.27 484.99,-319.2 495.57,-318.78 493,-312.27"/>
</g>
<!-- sourcefile~boundary_conditions_mod.f90&#45;&gt;sourcefile~data_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge40" class="edge">
<title>sourcefile~boundary_conditions_mod.f90&#45;&gt;sourcefile~data_mod.f90</title>
<path fill="none" stroke="#ff00ff" stroke-dasharray="5,2" d="M642.06,-191.36C616.18,-209.88 563.83,-245.48 515,-267.29 454.02,-294.53 416.85,-261.72 371,-310.29 323.34,-360.78 383.78,-412.9 335,-462.29 310.53,-487.06 292.07,-470.41 259,-481.29"/>
<path fill="none" stroke="#ff00ff" stroke-dasharray="5,2" d="M257,-481.29C210.93,-496.56 155.14,-486.76 117.26,-476.21"/>
<polygon fill="#ff00ff" stroke="#ff00ff" points="118.13,-472.82 107.55,-473.38 116.17,-479.54 118.13,-472.82"/>
</g>
<!-- sourcefile~boundary_conditions_mod.f90&#45;&gt;sourcefile~utility_functions_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge41" class="edge">
<title>sourcefile~boundary_conditions_mod.f90&#45;&gt;sourcefile~utility_functions_mod.f90</title>
<path fill="none" stroke="#ff00ff" stroke-dasharray="5,2" d="M592.94,-191.34C550.55,-198.88 494.13,-208.42 444,-215.29"/>
<path fill="none" stroke="#ff00ff" stroke-dasharray="5,2" d="M442,-215.29C326.77,-231.09 284.67,-181.56 181,-234.29 134.97,-257.7 100.8,-310.36 84.38,-339.99"/>
<polygon fill="#ff00ff" stroke="#ff00ff" points="81.14,-338.62 79.49,-349.08 87.31,-341.93 81.14,-338.62"/>
</g>
<!-- sourcefile~boundary_conditions_mod.f90&#45;&gt;sourcefile~array_operations_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge44" class="edge">
<title>sourcefile~boundary_conditions_mod.f90&#45;&gt;sourcefile~array_operations_mod.f90</title>
<path fill="none" stroke="#ff00ff" stroke-dasharray="5,2" d="M442,-215.29C398.71,-221.23 350.45,-231.95 314.36,-240.8"/>
<polygon fill="#ff00ff" stroke="#ff00ff" points="313.38,-237.44 304.52,-243.24 315.07,-244.23 313.38,-237.44"/>
</g>
<!-- sourcefile~boundary_conditions_mod.f90&#45;&gt;sourcefile~math_functions_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge43" class="edge">
<title>sourcefile~boundary_conditions_mod.f90&#45;&gt;sourcefile~math_functions_mod.f90</title>
<path fill="none" stroke="#ff00ff" stroke-dasharray="5,2" d="M596.82,-167.25C581.82,-164.32 565.84,-161.2 551,-158.29 539.39,-156.02 527.07,-153.6 515.08,-151.25"/>
<polygon fill="#ff00ff" stroke="#ff00ff" points="515.6,-147.78 505.11,-149.29 514.25,-154.65 515.6,-147.78"/>
</g>
<!-- sourcefile~channels_mod.f90&#45;&gt;sourcefile~input_reader_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge47" class="edge">
<title>sourcefile~channels_mod.f90&#45;&gt;sourcefile~input_reader_mod.f90</title>
<path fill="none" stroke="#ff007f" stroke-dasharray="5,2" d="M613.27,-376.27C579.9,-367.41 534.33,-355.3 498.88,-345.87"/>
<polygon fill="#ff007f" stroke="#ff007f" points="499.73,-342.48 489.17,-343.29 497.93,-349.24 499.73,-342.48"/>
</g>
<!-- sourcefile~channels_mod.f90&#45;&gt;sourcefile~data_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge45" class="edge">
<title>sourcefile~channels_mod.f90&#45;&gt;sourcefile~data_mod.f90</title>
<path fill="none" stroke="#ff007f" stroke-dasharray="5,2" d="M606.23,-400.35C587.91,-405.96 567.75,-413.76 551,-424.29 531.57,-436.5 531.65,-445.51 515,-461.29 484.59,-490.11 484.49,-512.53 444,-523.29"/>
<path fill="none" stroke="#ff007f" stroke-dasharray="5,2" d="M442,-523.29C361.72,-544.63 341.53,-570.7 259,-561.29"/>
</g>
<!-- sourcefile~channels_mod.f90&#45;&gt;sourcefile~utility_functions_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge46" class="edge">
<title>sourcefile~channels_mod.f90&#45;&gt;sourcefile~utility_functions_mod.f90</title>
<path fill="none" stroke="#ff007f" stroke-dasharray="5,2" d="M604.43,-384.72C546.23,-380.13 451.21,-370.49 371,-352.29 354.55,-348.56 351.19,-345.01 335,-340.29 301.57,-330.56 293.81,-320.39 259,-321.29"/>
</g>
<!-- sourcefile~input_validation_mod.f90&#45;&gt;sourcefile~data_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge49" class="edge">
<title>sourcefile~input_validation_mod.f90&#45;&gt;sourcefile~data_mod.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M234.87,-373.35C202.35,-391.07 141.54,-424.21 104.57,-444.36"/>
<polygon fill="#ff0000" stroke="#ff0000" points="102.82,-441.33 95.71,-449.19 106.17,-447.47 102.82,-441.33"/>
</g>
<!-- sourcefile~input_validation_mod.f90&#45;&gt;sourcefile~utility_functions_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge48" class="edge">
<title>sourcefile~input_validation_mod.f90&#45;&gt;sourcefile~utility_functions_mod.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M184.48,-361.29C174.88,-361.29 165,-361.29 155.27,-361.29"/>
<polygon fill="#ff0000" stroke="#ff0000" points="155.2,-357.79 145.2,-361.29 155.2,-364.79 155.2,-357.79"/>
</g>
<!-- sourcefile~centrifugal_matrix_mod.f90&#45;&gt;sourcefile~input_reader_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge51" class="edge">
<title>sourcefile~centrifugal_matrix_mod.f90&#45;&gt;sourcefile~input_reader_mod.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M579.24,-331.29C559.32,-331.29 538.01,-331.29 518.35,-331.29"/>
<polygon fill="#00ff00" stroke="#00ff00" points="518.23,-327.79 508.23,-331.29 518.23,-334.79 518.23,-327.79"/>
</g>
<!-- sourcefile~centrifugal_matrix_mod.f90&#45;&gt;sourcefile~data_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge50" class="edge">
<title>sourcefile~centrifugal_matrix_mod.f90&#45;&gt;sourcefile~data_mod.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M611,-343.34C591.75,-349.2 569.7,-357.18 551,-367.29 461.36,-415.74 448.61,-443.26 371,-509.29 354.47,-523.36 354.12,-532.01 335,-542.29 304.34,-558.78 293.59,-565.24 259,-561.29"/>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M257,-561.29C222.41,-557.32 212.42,-557.29 181,-542.29 147.3,-526.21 113.79,-498.64 93.36,-480.2"/>
<polygon fill="#00ff00" stroke="#00ff00" points="95.68,-477.57 85.95,-473.38 90.94,-482.73 95.68,-477.57"/>
</g>
<!-- sourcefile~centrifugal_matrix_mod.f90&#45;&gt;sourcefile~array_operations_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge52" class="edge">
<title>sourcefile~centrifugal_matrix_mod.f90&#45;&gt;sourcefile~array_operations_mod.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M637.15,-319.18C599.55,-298.87 518.43,-259.54 444,-253.29"/>
</g>
<!-- sourcefile~math_functions_mod.f90&#45;&gt;sourcefile~utility_functions_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge53" class="edge">
<title>sourcefile~math_functions_mod.f90&#45;&gt;sourcefile~utility_functions_mod.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M410.32,-125.16C365.07,-108.7 284.59,-82.92 259,-97.29"/>
</g>
<!-- sourcefile~special_functions_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_node17" class="node">
<title>sourcefile~special_functions_mod.f90</title>
<g id="a_sourcefile~~scattering.f90~~EfferentGraph_node17"><a xlink:href=".././sourcefile/special_functions_mod.f90.html" xlink:title="special_functions_mod.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="335,-149.29 181,-149.29 181,-125.29 335,-125.29 335,-149.29"/>
<text text-anchor="middle" x="258" y="-134.89" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">special_functions_mod.f90</text>
</a>
</g>
</g>
<!-- sourcefile~math_functions_mod.f90&#45;&gt;sourcefile~special_functions_mod.f90 -->
<g id="sourcefile~~scattering.f90~~EfferentGraph_edge54" class="edge">
<title>sourcefile~math_functions_mod.f90&#45;&gt;sourcefile~special_functions_mod.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M370.99,-137.29C362.54,-137.29 353.84,-137.29 345.21,-137.29"/>
<polygon fill="#0000ff" stroke="#0000ff" points="345.13,-133.79 335.13,-137.29 345.13,-140.79 345.13,-133.79"/>
</g>
</g>
</svg>
</div><script>var pansourcefilescatteringf90EfferentGraph = svgPanZoom('#sourcefilescatteringf90EfferentGraph', {zoomEnabled: true,controlIconsEnabled: true, fit: true, center: true,}); </script><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="202pt" height="32pt"
 viewBox="0.00 0.00 201.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-28 197.5,-28 197.5,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="71,-24 0,-24 0,0 71,0 71,-24"/>
<text text-anchor="middle" x="35.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="193.5,-24 89.5,-24 89.5,0 193.5,0 193.5,-24"/>
<text text-anchor="middle" x="141.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
<br>
    <section class="visible-xs visible-sm hidden-md">
        <h3>Contents</h3>
  
  
  
  
      <div class="panel panel-primary">
      <div class="panel-heading text-left">
        <h3 class="panel-title">
          <a data-toggle="collapse" href="#progs-1">Programs</a>
        </h3>
      </div>
      <div id="progs-1" class="panel-collapse collapse">
        <div class="list-group">
            <a class="list-group-item" href="../program/scattering.html">SCATTERING</a>
        </div>
      </div>
    </div>

  
  
  
  
  
  
  
  
  
  
  
  
  
  
    <div class="panel panel-primary">
      <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
      <div class="list-group">
        <a class="list-group-item" href="../sourcefile/scattering.f90.html#src">scattering.f90</a>
      </div>
    </div>


    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a id="ln-1" name="ln-1" href="#ln-1"></a><span class="k">program </span><span class="n">SCATTERING</span><span class="w"></span>
<a id="ln-2" name="ln-2" href="#ln-2"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-3" name="ln-3" href="#ln-3"></a><span class="w">   </span><span class="k">use</span><span class="p">,</span><span class="w"> </span><span class="k">intrinsic</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">iso_fortran_env</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">int32</span><span class="p">,</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">real32</span><span class="p">,</span><span class="w"> </span><span class="n">dp</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">real64</span><span class="w"></span>
<a id="ln-4" name="ln-4" href="#ln-4"></a><span class="w">   </span><span class="k">use </span><span class="n">data_mod</span><span class="w"></span>
<a id="ln-5" name="ln-5" href="#ln-5"></a><span class="w">   </span><span class="k">use </span><span class="n">io_mod</span><span class="w"></span>
<a id="ln-6" name="ln-6" href="#ln-6"></a><span class="w">   </span><span class="k">use </span><span class="n">radial_coupling_terms_mod</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">read_radial_coupling_terms</span><span class="p">,</span><span class="w">            </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-7" name="ln-7" href="#ln-7"></a><span class="w">      </span><span class="n">reduce_radial_coupling_terms</span><span class="p">,</span><span class="w"> </span><span class="n">interpolate_radial_coupling_terms</span><span class="w"></span>
<a id="ln-8" name="ln-8" href="#ln-8"></a><span class="w">   </span><span class="k">use </span><span class="n">channels_mod</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">set_number_of_channels</span><span class="p">,</span><span class="w"> </span><span class="n">set_body_fixed_channels</span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-9" name="ln-9" href="#ln-9"></a><span class="w">      </span><span class="n">set_space_fixed_channels</span><span class="p">,</span><span class="w"> </span><span class="n">count_open_channels_in_block</span><span class="p">,</span><span class="w">                  </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-10" name="ln-10" href="#ln-10"></a><span class="w">      </span><span class="n">calculate_largest_wavenumber</span><span class="p">,</span><span class="w"> </span><span class="n">print_short_block_summary</span><span class="p">,</span><span class="w"> </span><span class="n">print_channels</span><span class="w"></span>
<a id="ln-11" name="ln-11" href="#ln-11"></a><span class="w">   </span><span class="k">use </span><span class="n">pes_matrix_mod</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">initialize_pes_matrix</span><span class="w"></span>
<a id="ln-12" name="ln-12" href="#ln-12"></a><span class="w">   </span><span class="k">use </span><span class="n">propagator_mod</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">numerov</span><span class="w"></span>
<a id="ln-13" name="ln-13" href="#ln-13"></a><span class="w">   </span><span class="k">use </span><span class="n">boundary_conditions_mod</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">calculate_sf_matrix_from_bf_matrix</span><span class="p">,</span><span class="w">      </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-14" name="ln-14" href="#ln-14"></a><span class="w">      </span><span class="n">calculate_k_matrix</span><span class="p">,</span><span class="w"> </span><span class="n">calculate_s_matrix</span><span class="w"></span>
<a id="ln-15" name="ln-15" href="#ln-15"></a><span class="w">   </span><span class="k">use </span><span class="n">unitarity_check_mod</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">unitarity_check</span><span class="p">,</span><span class="w"> </span><span class="n">print_final_unitarity_warning</span><span class="w"></span>
<a id="ln-16" name="ln-16" href="#ln-16"></a><span class="w">   </span><span class="k">use </span><span class="n">save_s_matrix_mod</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">save_s_matrix_file_header</span><span class="p">,</span><span class="w"> </span><span class="n">save_s_matrix_block_info</span><span class="w"></span>
<a id="ln-17" name="ln-17" href="#ln-17"></a><span class="w">   </span><span class="k">use </span><span class="n">state_to_state_cross_sections_mod</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w">                                </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-18" name="ln-18" href="#ln-18"></a><span class="w">      </span><span class="n">calculate_state_to_state_cross_section</span><span class="p">,</span><span class="w">  </span><span class="n">add_cross_sections</span><span class="p">,</span><span class="w">             </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-19" name="ln-19" href="#ln-19"></a><span class="w">      </span><span class="n">print_largest_partial_cross_sections</span><span class="p">,</span><span class="w"> </span><span class="n">print_cross_sections_for_jtot</span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-20" name="ln-20" href="#ln-20"></a><span class="w">      </span><span class="n">print_final_cross_sections</span><span class="p">,</span><span class="w">  </span><span class="n">determine_largest_cross_sections</span><span class="p">,</span><span class="w">           </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-21" name="ln-21" href="#ln-21"></a><span class="w">      </span><span class="n">check_cross_section_thresholds</span><span class="p">,</span><span class="w"> </span><span class="n">save_partial_xs_file_header</span><span class="p">,</span><span class="w">             </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-22" name="ln-22" href="#ln-22"></a><span class="w">      </span><span class="n">save_partial_xs_single_block</span><span class="w"></span>
<a id="ln-23" name="ln-23" href="#ln-23"></a><span class="w">   </span><span class="k">use </span><span class="n">utility_functions_mod</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">write_header</span><span class="p">,</span><span class="w">               </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-24" name="ln-24" href="#ln-24"></a><span class="w">      </span><span class="n">write_message</span><span class="p">,</span><span class="w"> </span><span class="n">float_to_character</span><span class="p">,</span><span class="w"> </span><span class="n">integer_to_character</span><span class="p">,</span><span class="w"> </span><span class="n">time_count_summary</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-25" name="ln-25" href="#ln-25"></a><span class="w">      </span><span class="n">no_open_channels_message</span><span class="w"></span>
<a id="ln-26" name="ln-26" href="#ln-26"></a><span class="w">   </span><span class="k">use </span><span class="n">array_operations_mod</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">append</span><span class="w"></span>
<a id="ln-27" name="ln-27" href="#ln-27"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-28" name="ln-28" href="#ln-28"></a><span class="w">   </span><span class="k">implicit none</span><span class="w"></span>
<a id="ln-29" name="ln-29" href="#ln-29"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-30" name="ln-30" href="#ln-30"></a><span class="w">   </span><span class="kt">integer</span><span class="p">(</span><span class="n">int32</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">number_of_channels</span><span class="p">,</span><span class="w"> </span><span class="n">size_even</span><span class="p">,</span><span class="w"> </span><span class="n">size_odd</span><span class="p">,</span><span class="w">                  </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-31" name="ln-31" href="#ln-31"></a><span class="w">      </span><span class="n">number_of_open_basis_levels</span><span class="p">,</span><span class="w"> </span><span class="n">jtot_</span><span class="p">,</span><span class="w"> </span><span class="n">parity_exponent</span><span class="p">,</span><span class="w"> </span><span class="n">nsteps</span><span class="p">,</span><span class="w">             </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-32" name="ln-32" href="#ln-32"></a><span class="w">      </span><span class="n">number_of_open_channels</span><span class="p">,</span><span class="w"> </span><span class="n">max_elastic_index</span><span class="p">,</span><span class="w"> </span><span class="n">max_inelastic_index_1</span><span class="p">,</span><span class="w">       </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-33" name="ln-33" href="#ln-33"></a><span class="w">      </span><span class="n">max_inelastic_index_2</span><span class="p">,</span><span class="w"> </span><span class="n">iopen</span><span class="p">,</span><span class="w"> </span><span class="n">iopen2</span><span class="w"></span>
<a id="ln-34" name="ln-34" href="#ln-34"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-35" name="ln-35" href="#ln-35"></a><span class="w">   </span><span class="kt">integer</span><span class="p">(</span><span class="n">int32</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">count_blocks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<a id="ln-36" name="ln-36" href="#ln-36"></a><span class="w">   </span><span class="kt">integer</span><span class="p">(</span><span class="n">int32</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">consecutive_blocks_thresholddiag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<a id="ln-37" name="ln-37" href="#ln-37"></a><span class="w">   </span><span class="kt">integer</span><span class="p">(</span><span class="n">int32</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">consecutive_blocks_thresholdoff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<a id="ln-38" name="ln-38" href="#ln-38"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-39" name="ln-39" href="#ln-39"></a><span class="w">   </span><span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">largest_wavevector</span><span class="p">,</span><span class="w"> </span><span class="n">wavvdepth</span><span class="p">,</span><span class="w"> </span><span class="n">max_elastic_cross_section</span><span class="p">,</span><span class="w">       </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-40" name="ln-40" href="#ln-40"></a><span class="w">      </span><span class="n">max_inelastic_cross_section</span><span class="p">,</span><span class="w"> </span><span class="n">time_total_start</span><span class="p">,</span><span class="w"> </span><span class="n">time_total_stop</span><span class="p">,</span><span class="w">          </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-41" name="ln-41" href="#ln-41"></a><span class="w">      </span><span class="n">time_total</span><span class="p">,</span><span class="w"> </span><span class="n">time_init_stop</span><span class="p">,</span><span class="w"> </span><span class="n">time_init</span><span class="p">,</span><span class="w"> </span><span class="n">time_jtot_start</span><span class="p">,</span><span class="w">                  </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-42" name="ln-42" href="#ln-42"></a><span class="w">      </span><span class="n">time_jtot_stop</span><span class="p">,</span><span class="w"> </span><span class="n">time_jtot</span><span class="p">,</span><span class="w"> </span><span class="n">time_parity_start</span><span class="p">,</span><span class="n">time_parity_stop</span><span class="p">,</span><span class="w">           </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-43" name="ln-43" href="#ln-43"></a><span class="w">      </span><span class="n">time_parity</span><span class="w"></span>
<a id="ln-44" name="ln-44" href="#ln-44"></a><span class="w">   </span><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">unitarity_block_check</span><span class="w"></span>
<a id="ln-45" name="ln-45" href="#ln-45"></a><span class="w">   </span><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">terminate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<a id="ln-46" name="ln-46" href="#ln-46"></a><span class="w">   </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">channel_indices</span><span class="p">(:),</span><span class="w"> </span><span class="n">channels_omega_values</span><span class="p">(:),&amp;</span><span class="w"></span>
<a id="ln-47" name="ln-47" href="#ln-47"></a><span class="w">      </span><span class="n">channel_l_values</span><span class="p">(:),</span><span class="w"> </span><span class="n">open_basis_levels</span><span class="p">(:),</span><span class="w"> </span><span class="n">nonzero_terms_per_element</span><span class="p">(:),&amp;</span><span class="w"></span>
<a id="ln-48" name="ln-48" href="#ln-48"></a><span class="w">      </span><span class="n">nonzero_legendre_indices</span><span class="p">(:),</span><span class="w"> </span><span class="n">smatcheckarr</span><span class="p">(:)</span><span class="w"></span>
<a id="ln-49" name="ln-49" href="#ln-49"></a><span class="w">   </span><span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">wv</span><span class="p">(:),</span><span class="w"> </span><span class="n">open_basis_wavevectors</span><span class="p">(:),</span><span class="w">                  </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-50" name="ln-50" href="#ln-50"></a><span class="w">      </span><span class="n">nonzero_algebraic_coefficients</span><span class="p">(:),</span><span class="w"> </span><span class="n">accumulated_cross_sections</span><span class="p">(:),</span><span class="w">        </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-51" name="ln-51" href="#ln-51"></a><span class="w">      </span><span class="n">partial_cross_sections_block</span><span class="p">(:),</span><span class="w"> </span><span class="n">partial_cross_sections_jtot</span><span class="p">(:)</span><span class="w"></span>
<a id="ln-52" name="ln-52" href="#ln-52"></a><span class="w">   </span><span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">BF_log_der_matrix</span><span class="p">(:,:),</span><span class="w"> </span><span class="n">SF_log_der_matrix</span><span class="p">(:,:),</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-53" name="ln-53" href="#ln-53"></a><span class="w">      </span><span class="n">k_matrix</span><span class="p">(:,:),</span><span class="w"> </span><span class="n">s_matrix_real</span><span class="p">(:,:),</span><span class="w"> </span><span class="n">s_matrix_imag</span><span class="p">(:,:)</span><span class="w"></span>
<a id="ln-54" name="ln-54" href="#ln-54"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-55" name="ln-55" href="#ln-55"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-56" name="ln-56" href="#ln-56"></a><span class="w">   </span><span class="c">! Initizalization: start the time count</span>
<a id="ln-57" name="ln-57" href="#ln-57"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-58" name="ln-58" href="#ln-58"></a><span class="w">   </span><span class="k">call </span><span class="nb">cpu_time</span><span class="p">(</span><span class="n">time_total_start</span><span class="p">)</span><span class="w"></span>
<a id="ln-59" name="ln-59" href="#ln-59"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-60" name="ln-60" href="#ln-60"></a><span class="w">   </span><span class="c">! Initialize fwigxjpf library</span>
<a id="ln-61" name="ln-61" href="#ln-61"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-62" name="ln-62" href="#ln-62"></a><span class="w">   </span><span class="k">call </span><span class="n">fwig_table_init</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">)</span><span class="w"></span>
<a id="ln-63" name="ln-63" href="#ln-63"></a><span class="w">   </span><span class="k">call </span><span class="n">fwig_temp_init</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span><span class="w"></span>
<a id="ln-64" name="ln-64" href="#ln-64"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-65" name="ln-65" href="#ln-65"></a><span class="w">   </span><span class="c">! Print the header</span>
<a id="ln-66" name="ln-66" href="#ln-66"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-67" name="ln-67" href="#ln-67"></a><span class="w">   </span><span class="k">call </span><span class="n">write_header</span><span class="p">(</span><span class="s2">&quot;main&quot;</span><span class="p">)</span><span class="w"></span>
<a id="ln-68" name="ln-68" href="#ln-68"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-69" name="ln-69" href="#ln-69"></a><span class="w">   </span><span class="c">! Read the input file</span>
<a id="ln-70" name="ln-70" href="#ln-70"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-71" name="ln-71" href="#ln-71"></a><span class="w">   </span><span class="k">call </span><span class="n">read_input_file</span><span class="w"></span>
<a id="ln-72" name="ln-72" href="#ln-72"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-73" name="ln-73" href="#ln-73"></a><span class="w">   </span><span class="c">! S-matrix file: write input parameters and basis levels</span>
<a id="ln-74" name="ln-74" href="#ln-74"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-75" name="ln-75" href="#ln-75"></a><span class="w">   </span><span class="k">call </span><span class="n">save_s_matrix_file_header</span><span class="w"></span>
<a id="ln-76" name="ln-76" href="#ln-76"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-77" name="ln-77" href="#ln-77"></a><span class="w">   </span><span class="c">! Prepare the file with the partial XS</span>
<a id="ln-78" name="ln-78" href="#ln-78"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-79" name="ln-79" href="#ln-79"></a><span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">print_partial_cross_sections</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-80" name="ln-80" href="#ln-80"></a><span class="k">      call </span><span class="n">save_partial_xs_file_header</span><span class="w"></span>
<a id="ln-81" name="ln-81" href="#ln-81"></a><span class="w">   </span><span class="k">endif</span><span class="w"></span>
<a id="ln-82" name="ln-82" href="#ln-82"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-83" name="ln-83" href="#ln-83"></a><span class="w">   </span><span class="c">! Convert units: starting now, everything is in atomic units</span>
<a id="ln-84" name="ln-84" href="#ln-84"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-85" name="ln-85" href="#ln-85"></a><span class="w">   </span><span class="k">call </span><span class="n">units_conversion</span><span class="w"></span>
<a id="ln-86" name="ln-86" href="#ln-86"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-87" name="ln-87" href="#ln-87"></a><span class="w">   </span><span class="c">! Read the radial terms of the potential from external file</span>
<a id="ln-88" name="ln-88" href="#ln-88"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-89" name="ln-89" href="#ln-89"></a><span class="w">   </span><span class="k">call </span><span class="n">read_radial_coupling_terms</span><span class="w"></span>
<a id="ln-90" name="ln-90" href="#ln-90"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-91" name="ln-91" href="#ln-91"></a><span class="w">   </span><span class="c">! Reduce matrix elements that are not needed</span>
<a id="ln-92" name="ln-92" href="#ln-92"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-93" name="ln-93" href="#ln-93"></a><span class="w">   </span><span class="k">call </span><span class="n">reduce_radial_coupling_terms</span><span class="w"></span>
<a id="ln-94" name="ln-94" href="#ln-94"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-95" name="ln-95" href="#ln-95"></a><span class="w">   </span><span class="c">! Interpolate radial terms                                            </span>
<a id="ln-96" name="ln-96" href="#ln-96"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-97" name="ln-97" href="#ln-97"></a><span class="w">   </span><span class="k">call </span><span class="n">interpolate_radial_coupling_terms</span><span class="w"></span>
<a id="ln-98" name="ln-98" href="#ln-98"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-99" name="ln-99" href="#ln-99"></a><span class="w">   </span><span class="c">! Search for energetically accessible levels and prepare the arrays that are</span>
<a id="ln-100" name="ln-100" href="#ln-100"></a><span class="w">   </span><span class="c">! needed in the calculations of the state-to-state XS                       </span>
<a id="ln-101" name="ln-101" href="#ln-101"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-102" name="ln-102" href="#ln-102"></a><span class="w">   </span><span class="n">number_of_open_basis_levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">count_open_basis_levels</span><span class="p">()</span><span class="w"></span>
<a id="ln-103" name="ln-103" href="#ln-103"></a><span class="w">   </span><span class="k">call </span><span class="n">save_open_basis_levels</span><span class="p">(</span><span class="n">number_of_open_basis_levels</span><span class="p">,</span><span class="w"> </span><span class="n">open_basis_levels</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-104" name="ln-104" href="#ln-104"></a><span class="w">      </span><span class="n">open_basis_wavevectors</span><span class="p">)</span><span class="w"></span>
<a id="ln-105" name="ln-105" href="#ln-105"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-106" name="ln-106" href="#ln-106"></a><span class="w">   </span><span class="c">! Initialize arrays that save the state-to-state cross-sections</span>
<a id="ln-107" name="ln-107" href="#ln-107"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-108" name="ln-108" href="#ln-108"></a><span class="w">   </span><span class="k">call </span><span class="n">allocate_1d</span><span class="p">(</span><span class="n">accumulated_cross_sections</span><span class="p">,</span><span class="w">                                </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-109" name="ln-109" href="#ln-109"></a><span class="w">      </span><span class="n">number_of_open_basis_levels</span><span class="o">*</span><span class="n">number_of_open_basis_levels</span><span class="p">)</span><span class="w"></span>
<a id="ln-110" name="ln-110" href="#ln-110"></a><span class="w">   </span><span class="k">call </span><span class="n">allocate_1d</span><span class="p">(</span><span class="n">partial_cross_sections_jtot</span><span class="p">,</span><span class="w">                               </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-111" name="ln-111" href="#ln-111"></a><span class="w">      </span><span class="n">number_of_open_basis_levels</span><span class="o">*</span><span class="n">number_of_open_basis_levels</span><span class="p">)</span><span class="w"></span>
<a id="ln-112" name="ln-112" href="#ln-112"></a><span class="w">   </span><span class="k">call </span><span class="n">allocate_1d</span><span class="p">(</span><span class="n">partial_cross_sections_block</span><span class="p">,</span><span class="w">                              </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-113" name="ln-113" href="#ln-113"></a><span class="w">      </span><span class="n">number_of_open_basis_levels</span><span class="o">*</span><span class="n">number_of_open_basis_levels</span><span class="p">)</span><span class="w"></span>
<a id="ln-114" name="ln-114" href="#ln-114"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-115" name="ln-115" href="#ln-115"></a><span class="w">   </span><span class="c">! Initialization is finished                                                </span>
<a id="ln-116" name="ln-116" href="#ln-116"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-117" name="ln-117" href="#ln-117"></a><span class="w">   </span><span class="k">call </span><span class="nb">cpu_time</span><span class="p">(</span><span class="n">time_init_stop</span><span class="p">)</span><span class="w"></span>
<a id="ln-118" name="ln-118" href="#ln-118"></a><span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">prntlvl</span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">call </span><span class="n">time_count_summary</span><span class="p">(</span><span class="n">time_total_start</span><span class="p">,</span><span class="w"> </span><span class="n">time_init_stop</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-119" name="ln-119" href="#ln-119"></a><span class="w">      </span><span class="n">time_init</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Initialization completed in &quot;</span><span class="p">)</span><span class="w"></span>
<a id="ln-120" name="ln-120" href="#ln-120"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-121" name="ln-121" href="#ln-121"></a><span class="w">   </span><span class="c">! Loop over total angular momentum</span>
<a id="ln-122" name="ln-122" href="#ln-122"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-123" name="ln-123" href="#ln-123"></a><span class="w">   </span><span class="k">call </span><span class="n">write_header</span><span class="p">(</span><span class="s2">&quot;jtot_loop&quot;</span><span class="p">)</span><span class="w"></span>
<a id="ln-124" name="ln-124" href="#ln-124"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-125" name="ln-125" href="#ln-125"></a><span class="w">   </span><span class="k">do </span><span class="n">jtot_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jtotmin</span><span class="p">,</span><span class="n">jtotmax</span><span class="p">,</span><span class="n">jtotstep</span><span class="w"></span>
<a id="ln-126" name="ln-126" href="#ln-126"></a><span class="w">      </span><span class="c">!------------------------------------------------------------------------!</span>
<a id="ln-127" name="ln-127" href="#ln-127"></a><span class="w">      </span><span class="k">call </span><span class="n">write_header</span><span class="p">(</span><span class="s2">&quot;block&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">opt_integer_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jtot_</span><span class="p">)</span><span class="w"></span>
<a id="ln-128" name="ln-128" href="#ln-128"></a><span class="w">      </span><span class="c">!------------------------------------------------------------------------!</span>
<a id="ln-129" name="ln-129" href="#ln-129"></a><span class="w">      </span><span class="k">call </span><span class="nb">cpu_time</span><span class="p">(</span><span class="n">time_jtot_start</span><span class="p">)</span><span class="w"></span>
<a id="ln-130" name="ln-130" href="#ln-130"></a><span class="w">      </span><span class="c">!------------------------------------------------------------------------!</span>
<a id="ln-131" name="ln-131" href="#ln-131"></a><span class="w">      </span><span class="n">partial_cross_sections_jtot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<a id="ln-132" name="ln-132" href="#ln-132"></a><span class="w">      </span><span class="k">call </span><span class="n">set_number_of_channels</span><span class="p">(</span><span class="n">jtot_</span><span class="p">,</span><span class="w"> </span><span class="n">size_even</span><span class="p">,</span><span class="w"> </span><span class="n">size_odd</span><span class="p">)</span><span class="w"></span>
<a id="ln-133" name="ln-133" href="#ln-133"></a><span class="w">      </span><span class="c">!------------------------------------------------------------------------!</span>
<a id="ln-134" name="ln-134" href="#ln-134"></a><span class="w">      </span><span class="k">do </span><span class="n">parity_exponent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="w"></span>
<a id="ln-135" name="ln-135" href="#ln-135"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-136" name="ln-136" href="#ln-136"></a><span class="w">         </span><span class="k">call </span><span class="nb">cpu_time</span><span class="p">(</span><span class="n">time_parity_start</span><span class="p">)</span><span class="w"></span>
<a id="ln-137" name="ln-137" href="#ln-137"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-138" name="ln-138" href="#ln-138"></a><span class="w">         </span><span class="k">select case</span><span class="p">(</span><span class="n">parity_exponent</span><span class="p">)</span><span class="w"></span>
<a id="ln-139" name="ln-139" href="#ln-139"></a><span class="w">            </span><span class="k">case</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<a id="ln-140" name="ln-140" href="#ln-140"></a><span class="w">               </span><span class="n">number_of_channels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">size_even</span><span class="w"></span>
<a id="ln-141" name="ln-141" href="#ln-141"></a><span class="w">            </span><span class="k">case</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-142" name="ln-142" href="#ln-142"></a><span class="w">               </span><span class="n">number_of_channels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">size_odd</span><span class="w"></span>
<a id="ln-143" name="ln-143" href="#ln-143"></a><span class="w">         </span><span class="k">end select</span><span class="w"></span>
<a id="ln-144" name="ln-144" href="#ln-144"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-145" name="ln-145" href="#ln-145"></a><span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">number_of_channels</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">cycle</span><span class="w"></span>
<a id="ln-146" name="ln-146" href="#ln-146"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-147" name="ln-147" href="#ln-147"></a><span class="w">         </span><span class="c">! Summary of the current block</span>
<a id="ln-148" name="ln-148" href="#ln-148"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-149" name="ln-149" href="#ln-149"></a><span class="w">         </span><span class="n">count_blocks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">count_blocks</span><span class="o">+</span><span class="mi">1</span><span class="w"></span>
<a id="ln-150" name="ln-150" href="#ln-150"></a><span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">prntlvl</span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-151" name="ln-151" href="#ln-151"></a><span class="k">            call </span><span class="n">print_short_block_summary</span><span class="p">(</span><span class="n">jtot_</span><span class="p">,</span><span class="w"> </span><span class="n">parity_exponent</span><span class="p">,</span><span class="w"> </span><span class="n">count_blocks</span><span class="p">,&amp;</span><span class="w"></span>
<a id="ln-152" name="ln-152" href="#ln-152"></a><span class="w">               </span><span class="n">number_of_channels</span><span class="p">)</span><span class="w"></span>
<a id="ln-153" name="ln-153" href="#ln-153"></a><span class="w">         </span><span class="k">endif</span><span class="w"></span>
<a id="ln-154" name="ln-154" href="#ln-154"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-155" name="ln-155" href="#ln-155"></a><span class="w">         </span><span class="c">! Prepare of the basis for each J/p block:</span>
<a id="ln-156" name="ln-156" href="#ln-156"></a><span class="w">         </span><span class="c">! channels_omega_values holds all values of omega (BF_)</span>
<a id="ln-157" name="ln-157" href="#ln-157"></a><span class="w">         </span><span class="c">! channel_l_values holds all values of l (SF_)</span>
<a id="ln-158" name="ln-158" href="#ln-158"></a><span class="w">         </span><span class="c">! channel_indices holds the indices which refer to the basis arrays:</span>
<a id="ln-159" name="ln-159" href="#ln-159"></a><span class="w">         </span><span class="c">!   --   v1level/j1level/elevel</span>
<a id="ln-160" name="ln-160" href="#ln-160"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-161" name="ln-161" href="#ln-161"></a><span class="w">         </span><span class="k">call </span><span class="n">allocate_1d</span><span class="p">(</span><span class="n">channels_omega_values</span><span class="p">,</span><span class="n">number_of_channels</span><span class="p">)</span><span class="w"></span>
<a id="ln-162" name="ln-162" href="#ln-162"></a><span class="w">         </span><span class="k">call </span><span class="n">allocate_1d</span><span class="p">(</span><span class="n">channel_l_values</span><span class="p">,</span><span class="n">number_of_channels</span><span class="p">)</span><span class="w"></span>
<a id="ln-163" name="ln-163" href="#ln-163"></a><span class="w">         </span><span class="k">call </span><span class="n">allocate_1d</span><span class="p">(</span><span class="n">channel_indices</span><span class="p">,</span><span class="n">number_of_channels</span><span class="p">)</span><span class="w"></span>
<a id="ln-164" name="ln-164" href="#ln-164"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-165" name="ln-165" href="#ln-165"></a><span class="w">         </span><span class="c">! Prepare channels_omega_values, channel_indices and channel_l_values</span>
<a id="ln-166" name="ln-166" href="#ln-166"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-167" name="ln-167" href="#ln-167"></a><span class="w">         </span><span class="k">call </span><span class="n">set_body_fixed_channels</span><span class="p">(</span><span class="n">jtot_</span><span class="p">,</span><span class="w"> </span><span class="n">parity_exponent</span><span class="p">,</span><span class="w"> </span><span class="n">channel_indices</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-168" name="ln-168" href="#ln-168"></a><span class="w">            </span><span class="n">channels_omega_values</span><span class="p">)</span><span class="w"></span>
<a id="ln-169" name="ln-169" href="#ln-169"></a><span class="w">         </span><span class="k">call </span><span class="n">set_space_fixed_channels</span><span class="p">(</span><span class="n">jtot_</span><span class="p">,</span><span class="w"> </span><span class="n">parity_exponent</span><span class="p">,</span><span class="w"> </span><span class="n">channel_l_values</span><span class="p">)</span><span class="w"></span>
<a id="ln-170" name="ln-170" href="#ln-170"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-171" name="ln-171" href="#ln-171"></a><span class="w">         </span><span class="c">! Print the BF quantum numbers on screen</span>
<a id="ln-172" name="ln-172" href="#ln-172"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-173" name="ln-173" href="#ln-173"></a><span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">prntlvl</span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">call </span><span class="n">print_channels</span><span class="p">(</span><span class="n">parity_exponent</span><span class="p">,</span><span class="w">                </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-174" name="ln-174" href="#ln-174"></a><span class="w">            </span><span class="n">channel_indices</span><span class="p">,</span><span class="w"> </span><span class="n">channels_omega_values</span><span class="p">)</span><span class="w"></span>
<a id="ln-175" name="ln-175" href="#ln-175"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-176" name="ln-176" href="#ln-176"></a><span class="w">         </span><span class="c">! Determine the number of open (energetically accessible) channels</span>
<a id="ln-177" name="ln-177" href="#ln-177"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-178" name="ln-178" href="#ln-178"></a><span class="w">         </span><span class="n">number_of_open_channels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">count_open_channels_in_block</span><span class="p">(</span><span class="n">channel_indices</span><span class="p">)</span><span class="w"></span>
<a id="ln-179" name="ln-179" href="#ln-179"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-180" name="ln-180" href="#ln-180"></a><span class="w">         </span><span class="c">! If there are no open channels, skip this block</span>
<a id="ln-181" name="ln-181" href="#ln-181"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-182" name="ln-182" href="#ln-182"></a><span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">number_of_open_channels</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-183" name="ln-183" href="#ln-183"></a><span class="k">            call </span><span class="n">no_open_channels_message</span><span class="p">(</span><span class="n">count_blocks</span><span class="p">)</span><span class="w"></span>
<a id="ln-184" name="ln-184" href="#ln-184"></a><span class="w">            </span><span class="k">cycle</span>
<a id="ln-185" name="ln-185" href="#ln-185"></a><span class="k">         endif</span><span class="w"></span>
<a id="ln-186" name="ln-186" href="#ln-186"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-187" name="ln-187" href="#ln-187"></a><span class="w">         </span><span class="c">! Determine the largest wavevector in the block</span>
<a id="ln-188" name="ln-188" href="#ln-188"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-189" name="ln-189" href="#ln-189"></a><span class="w">         </span><span class="n">largest_wavevector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calculate_largest_wavenumber</span><span class="p">(</span><span class="n">channel_indices</span><span class="p">)</span><span class="w"></span>
<a id="ln-190" name="ln-190" href="#ln-190"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-191" name="ln-191" href="#ln-191"></a><span class="w">         </span><span class="c">! Determine the number of steps on the intermolecular (R) grid</span>
<a id="ln-192" name="ln-192" href="#ln-192"></a><span class="w">         </span><span class="c">! This is done either directly (if dr &gt; 0)</span>
<a id="ln-193" name="ln-193" href="#ln-193"></a><span class="w">         </span><span class="c">! or through the number of steps per half de Broglie wavelength</span>
<a id="ln-194" name="ln-194" href="#ln-194"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-195" name="ln-195" href="#ln-195"></a><span class="w">         </span><span class="n">wavvdepth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">dsqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">reduced_mass</span><span class="o">*</span><span class="n">vdepth</span><span class="p">)</span><span class="w"></span>
<a id="ln-196" name="ln-196" href="#ln-196"></a><span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dr</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-197" name="ln-197" href="#ln-197"></a><span class="k">            </span><span class="n">nsteps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">nint</span><span class="p">((</span><span class="n">Rmax</span><span class="o">-</span><span class="n">Rmin</span><span class="p">)</span><span class="o">/</span><span class="n">PI</span><span class="o">*</span><span class="p">((</span><span class="n">largest_wavevector</span><span class="o">+</span><span class="n">wavvdepth</span><span class="p">)</span><span class="o">*</span><span class="n">steps</span><span class="p">))</span><span class="w"></span>
<a id="ln-198" name="ln-198" href="#ln-198"></a><span class="w">         </span><span class="k">else</span>
<a id="ln-199" name="ln-199" href="#ln-199"></a><span class="k">            </span><span class="n">nsteps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">nint</span><span class="p">((</span><span class="n">Rmax</span><span class="o">-</span><span class="n">Rmin</span><span class="p">)</span><span class="o">/</span><span class="n">dr</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="w"></span>
<a id="ln-200" name="ln-200" href="#ln-200"></a><span class="w">         </span><span class="k">endif</span><span class="w"></span>
<a id="ln-201" name="ln-201" href="#ln-201"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-202" name="ln-202" href="#ln-202"></a><span class="w">         </span><span class="c">! Prepare the PES matrix</span>
<a id="ln-203" name="ln-203" href="#ln-203"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-204" name="ln-204" href="#ln-204"></a><span class="w">         </span><span class="k">call </span><span class="n">initialize_pes_matrix</span><span class="p">(</span><span class="n">channel_indices</span><span class="p">,</span><span class="w"> </span><span class="n">channels_omega_values</span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-205" name="ln-205" href="#ln-205"></a><span class="w">            </span><span class="n">nonzero_terms_per_element</span><span class="p">,</span><span class="w"> </span><span class="n">nonzero_legendre_indices</span><span class="p">,</span><span class="w">               </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-206" name="ln-206" href="#ln-206"></a><span class="w">            </span><span class="n">nonzero_algebraic_coefficients</span><span class="p">)</span><span class="w"></span>
<a id="ln-207" name="ln-207" href="#ln-207"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-208" name="ln-208" href="#ln-208"></a><span class="w">         </span><span class="c">! Prepare the log-derivative matrix (Eqs. 6.29 and 6.43)</span>
<a id="ln-209" name="ln-209" href="#ln-209"></a><span class="w">         </span><span class="c">! and the K-matrix (Eq. 6.53)</span>
<a id="ln-210" name="ln-210" href="#ln-210"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-211" name="ln-211" href="#ln-211"></a><span class="w">         </span><span class="k">call </span><span class="n">allocate_2d</span><span class="p">(</span><span class="n">BF_log_der_matrix</span><span class="p">,</span><span class="w"> </span><span class="n">number_of_channels</span><span class="p">,</span><span class="w"> </span><span class="n">number_of_channels</span><span class="p">)</span><span class="w"></span>
<a id="ln-212" name="ln-212" href="#ln-212"></a><span class="w">         </span><span class="k">call </span><span class="n">allocate_2d</span><span class="p">(</span><span class="n">SF_log_der_matrix</span><span class="p">,</span><span class="w"> </span><span class="n">number_of_channels</span><span class="p">,</span><span class="w"> </span><span class="n">number_of_channels</span><span class="p">)</span><span class="w"></span>
<a id="ln-213" name="ln-213" href="#ln-213"></a><span class="w">         </span><span class="k">call </span><span class="n">allocate_2d</span><span class="p">(</span><span class="n">k_matrix</span><span class="p">,</span><span class="w"> </span><span class="n">number_of_open_channels</span><span class="p">,</span><span class="w"> </span><span class="n">number_of_open_channels</span><span class="p">)</span><span class="w"></span>
<a id="ln-214" name="ln-214" href="#ln-214"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-215" name="ln-215" href="#ln-215"></a><span class="w">         </span><span class="c">! Call the propagator:</span>
<a id="ln-216" name="ln-216" href="#ln-216"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-217" name="ln-217" href="#ln-217"></a><span class="w">         </span><span class="k">call </span><span class="n">numerov</span><span class="p">(</span><span class="n">number_of_channels</span><span class="p">,</span><span class="w"> </span><span class="n">channel_indices</span><span class="p">,</span><span class="w">                     </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-218" name="ln-218" href="#ln-218"></a><span class="w">            </span><span class="n">channels_omega_values</span><span class="p">,</span><span class="w"> </span><span class="n">nonzero_terms_per_element</span><span class="p">,</span><span class="w">                  </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-219" name="ln-219" href="#ln-219"></a><span class="w">            </span><span class="n">nonzero_legendre_indices</span><span class="p">,</span><span class="w"> </span><span class="n">nonzero_algebraic_coefficients</span><span class="p">,</span><span class="w"> </span><span class="n">nsteps</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-220" name="ln-220" href="#ln-220"></a><span class="w">            </span><span class="n">jtot_</span><span class="p">,</span><span class="w"> </span><span class="n">BF_log_der_matrix</span><span class="p">)</span><span class="w"></span>
<a id="ln-221" name="ln-221" href="#ln-221"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-222" name="ln-222" href="#ln-222"></a><span class="w">         </span><span class="c">! Transform the log-derivative matrix to the SF frame</span>
<a id="ln-223" name="ln-223" href="#ln-223"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-224" name="ln-224" href="#ln-224"></a><span class="w">         </span><span class="k">call </span><span class="n">calculate_sf_matrix_from_bf_matrix</span><span class="p">(</span><span class="n">number_of_channels</span><span class="p">,</span><span class="w"> </span><span class="n">jtot_</span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-225" name="ln-225" href="#ln-225"></a><span class="w">            </span><span class="n">channel_indices</span><span class="p">,</span><span class="w"> </span><span class="n">channels_omega_values</span><span class="p">,</span><span class="w"> </span><span class="n">channel_l_values</span><span class="p">,</span><span class="w">  </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-226" name="ln-226" href="#ln-226"></a><span class="w">            </span><span class="n">BF_log_der_matrix</span><span class="p">,</span><span class="w"> </span><span class="n">SF_log_der_matrix</span><span class="p">)</span><span class="w"></span>
<a id="ln-227" name="ln-227" href="#ln-227"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-228" name="ln-228" href="#ln-228"></a><span class="w">         </span><span class="c">! Get the K-matrix from log-derivative matrix (Eq. 6.53)</span>
<a id="ln-229" name="ln-229" href="#ln-229"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-230" name="ln-230" href="#ln-230"></a><span class="w">         </span><span class="k">call </span><span class="n">calculate_k_matrix</span><span class="p">(</span><span class="n">number_of_channels</span><span class="p">,</span><span class="w"> </span><span class="n">SF_log_der_matrix</span><span class="p">,</span><span class="w">        </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-231" name="ln-231" href="#ln-231"></a><span class="w">            </span><span class="n">number_of_open_channels</span><span class="p">,</span><span class="w"> </span><span class="n">channel_indices</span><span class="p">,</span><span class="w"> </span><span class="n">channel_l_values</span><span class="p">,&amp;</span><span class="w"></span>
<a id="ln-232" name="ln-232" href="#ln-232"></a><span class="w">            </span><span class="n">rmax</span><span class="p">,</span><span class="w"> </span><span class="n">k_matrix</span><span class="p">)</span><span class="w"></span>
<a id="ln-233" name="ln-233" href="#ln-233"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-234" name="ln-234" href="#ln-234"></a><span class="w">         </span><span class="c">! Get the S-matrix from the K-matrix (Eq. 6.57)</span>
<a id="ln-235" name="ln-235" href="#ln-235"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-236" name="ln-236" href="#ln-236"></a><span class="w">         </span><span class="k">call </span><span class="n">allocate_2d</span><span class="p">(</span><span class="n">s_matrix_real</span><span class="p">,</span><span class="n">number_of_open_channels</span><span class="p">,</span><span class="n">number_of_open_channels</span><span class="p">)</span><span class="w"></span>
<a id="ln-237" name="ln-237" href="#ln-237"></a><span class="w">         </span><span class="k">call </span><span class="n">allocate_2d</span><span class="p">(</span><span class="n">s_matrix_imag</span><span class="p">,</span><span class="n">number_of_open_channels</span><span class="p">,</span><span class="n">number_of_open_channels</span><span class="p">)</span><span class="w"></span>
<a id="ln-238" name="ln-238" href="#ln-238"></a><span class="w">         </span><span class="k">call </span><span class="n">calculate_s_matrix</span><span class="p">(</span><span class="n">number_of_open_channels</span><span class="p">,</span><span class="n">k_matrix</span><span class="p">,</span><span class="n">s_matrix_real</span><span class="p">,</span><span class="n">s_matrix_imag</span><span class="p">)</span><span class="w"></span>
<a id="ln-239" name="ln-239" href="#ln-239"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-240" name="ln-240" href="#ln-240"></a><span class="w">         </span><span class="c">! Array of wavevectors (necessary for the XS calculations)</span>
<a id="ln-241" name="ln-241" href="#ln-241"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-242" name="ln-242" href="#ln-242"></a><span class="w">         </span><span class="k">call </span><span class="n">allocate_1d</span><span class="p">(</span><span class="n">wv</span><span class="p">,</span><span class="w"> </span><span class="n">number_of_open_channels</span><span class="p">)</span><span class="w"></span>
<a id="ln-243" name="ln-243" href="#ln-243"></a><span class="w">         </span><span class="k">do </span><span class="n">iopen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">number_of_open_channels</span><span class="w"></span>
<a id="ln-244" name="ln-244" href="#ln-244"></a><span class="w">            </span><span class="n">wv</span><span class="p">(</span><span class="n">iopen</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">dsqrt</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">reduced_mass</span><span class="o">*</span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-245" name="ln-245" href="#ln-245"></a><span class="w">               </span><span class="p">(</span><span class="n">ETOTAL</span><span class="p">()</span><span class="o">-</span><span class="n">elevel</span><span class="p">(</span><span class="n">channel_indices</span><span class="p">(</span><span class="n">iopen</span><span class="p">)))))</span><span class="o">/</span><span class="n">bohrtoangstrom</span><span class="w"></span>
<a id="ln-246" name="ln-246" href="#ln-246"></a><span class="w">         </span><span class="k">enddo</span><span class="w"></span>
<a id="ln-247" name="ln-247" href="#ln-247"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-248" name="ln-248" href="#ln-248"></a><span class="w">         </span><span class="c">! S-matrix is written to the binary S-matrix file</span>
<a id="ln-249" name="ln-249" href="#ln-249"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-250" name="ln-250" href="#ln-250"></a><span class="w">         </span><span class="k">call </span><span class="n">save_s_matrix_block_info</span><span class="p">(</span><span class="n">jtot_</span><span class="p">,</span><span class="w"> </span><span class="n">parity_exponent</span><span class="p">,</span><span class="w">                 </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-251" name="ln-251" href="#ln-251"></a><span class="w">            </span><span class="n">number_of_open_channels</span><span class="p">,</span><span class="w"> </span><span class="n">channel_indices</span><span class="p">,</span><span class="w"> </span><span class="n">channel_l_values</span><span class="p">,</span><span class="w"> </span><span class="n">wv</span><span class="p">,</span><span class="w">    </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-252" name="ln-252" href="#ln-252"></a><span class="w">            </span><span class="n">s_matrix_real</span><span class="p">,</span><span class="w"> </span><span class="n">s_matrix_imag</span><span class="p">)</span><span class="w"></span>
<a id="ln-253" name="ln-253" href="#ln-253"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-254" name="ln-254" href="#ln-254"></a><span class="w">         </span><span class="c">! Check if the S-matrices are unitary</span>
<a id="ln-255" name="ln-255" href="#ln-255"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-256" name="ln-256" href="#ln-256"></a><span class="w">         </span><span class="k">call </span><span class="n">unitarity_check</span><span class="p">(</span><span class="n">number_of_open_channels</span><span class="p">,</span><span class="w"> </span><span class="n">s_matrix_real</span><span class="p">,</span><span class="w">          </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-257" name="ln-257" href="#ln-257"></a><span class="w">            </span><span class="n">s_matrix_imag</span><span class="p">,</span><span class="w"> </span><span class="n">unitarity_block_check</span><span class="p">)</span><span class="w"></span>
<a id="ln-258" name="ln-258" href="#ln-258"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-259" name="ln-259" href="#ln-259"></a><span class="w">         </span><span class="c">! If the unitary is not fulfilled, keep the information about this block</span>
<a id="ln-260" name="ln-260" href="#ln-260"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-261" name="ln-261" href="#ln-261"></a><span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.(</span><span class="n">unitarity_block_check</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<a id="ln-262" name="ln-262" href="#ln-262"></a><span class="k">            call </span><span class="n">append</span><span class="p">(</span><span class="n">smatcheckarr</span><span class="p">,</span><span class="w"> </span><span class="n">jtot_</span><span class="p">)</span><span class="w"></span>
<a id="ln-263" name="ln-263" href="#ln-263"></a><span class="w">         </span><span class="k">endif</span><span class="w"></span>
<a id="ln-264" name="ln-264" href="#ln-264"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-265" name="ln-265" href="#ln-265"></a><span class="w">         </span><span class="c">! Calculate all available cross-sections</span>
<a id="ln-266" name="ln-266" href="#ln-266"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-267" name="ln-267" href="#ln-267"></a><span class="w">         </span><span class="k">call </span><span class="n">calculate_state_to_state_cross_section</span><span class="p">(</span><span class="n">jtot_</span><span class="p">,</span><span class="w"> </span><span class="n">open_basis_levels</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-268" name="ln-268" href="#ln-268"></a><span class="w">            </span><span class="n">open_basis_wavevectors</span><span class="p">,</span><span class="n">s_matrix_real</span><span class="p">,</span><span class="n">s_matrix_imag</span><span class="p">,</span><span class="n">channel_indices</span><span class="p">,&amp;</span><span class="w"></span>
<a id="ln-269" name="ln-269" href="#ln-269"></a><span class="w">            </span><span class="n">channel_l_values</span><span class="p">,</span><span class="n">partial_cross_sections_block</span><span class="p">)</span><span class="w"></span>
<a id="ln-270" name="ln-270" href="#ln-270"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-271" name="ln-271" href="#ln-271"></a><span class="w">         </span><span class="c">! Print the results from this parity block to the partial XS file</span>
<a id="ln-272" name="ln-272" href="#ln-272"></a><span class="w">         </span><span class="c">! and add the calculated partial XS to the partial_cross_sections_jtot array</span>
<a id="ln-273" name="ln-273" href="#ln-273"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-274" name="ln-274" href="#ln-274"></a><span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">print_partial_cross_sections</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-275" name="ln-275" href="#ln-275"></a><span class="k">            call </span><span class="n">save_partial_xs_single_block</span><span class="p">(</span><span class="n">jtot_</span><span class="p">,</span><span class="w"> </span><span class="n">count_blocks</span><span class="p">,</span><span class="w">             </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-276" name="ln-276" href="#ln-276"></a><span class="w">               </span><span class="n">open_basis_levels</span><span class="p">,</span><span class="w"> </span><span class="n">partial_cross_sections_block</span><span class="p">)</span><span class="w"></span>
<a id="ln-277" name="ln-277" href="#ln-277"></a><span class="w">         </span><span class="k">endif</span>
<a id="ln-278" name="ln-278" href="#ln-278"></a><span class="k">         call </span><span class="n">add_cross_sections</span><span class="p">(</span><span class="n">number_of_open_basis_levels</span><span class="p">,</span><span class="w">                  </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-279" name="ln-279" href="#ln-279"></a><span class="w">            </span><span class="n">partial_cross_sections_block</span><span class="p">,</span><span class="w"> </span><span class="n">partial_cross_sections_jtot</span><span class="p">)</span><span class="w"></span>
<a id="ln-280" name="ln-280" href="#ln-280"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-281" name="ln-281" href="#ln-281"></a><span class="w">         </span><span class="c">! Check the time after each parity block:</span>
<a id="ln-282" name="ln-282" href="#ln-282"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-283" name="ln-283" href="#ln-283"></a><span class="w">         </span><span class="k">call </span><span class="nb">cpu_time</span><span class="p">(</span><span class="n">time_parity_stop</span><span class="p">)</span><span class="w"></span>
<a id="ln-284" name="ln-284" href="#ln-284"></a><span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">prntlvl</span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">call </span><span class="n">time_count_summary</span><span class="p">(</span><span class="n">time_parity_start</span><span class="p">,</span><span class="w">          </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-285" name="ln-285" href="#ln-285"></a><span class="w">            </span><span class="n">time_parity_stop</span><span class="p">,</span><span class="w"> </span><span class="n">time_parity</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Parity block completed in &quot;</span><span class="p">)</span><span class="w"></span>
<a id="ln-286" name="ln-286" href="#ln-286"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-287" name="ln-287" href="#ln-287"></a><span class="w">         </span><span class="c">! ... end of the loop over parity                                      </span>
<a id="ln-288" name="ln-288" href="#ln-288"></a><span class="w">         </span><span class="c">!---------------------------------------------------------------------!</span>
<a id="ln-289" name="ln-289" href="#ln-289"></a><span class="w">         </span><span class="k">call </span><span class="n">write_message</span><span class="p">(</span><span class="nb">repeat</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">90</span><span class="p">))</span><span class="w"></span>
<a id="ln-290" name="ln-290" href="#ln-290"></a><span class="w">      </span><span class="k">enddo</span><span class="w"></span>
<a id="ln-291" name="ln-291" href="#ln-291"></a><span class="w">      </span><span class="c">!------------------------------------------------------------------------!</span>
<a id="ln-292" name="ln-292" href="#ln-292"></a><span class="w">      </span><span class="c">! Add the cross-sections from this Jtot block:</span>
<a id="ln-293" name="ln-293" href="#ln-293"></a><span class="w">      </span><span class="c">!------------------------------------------------------------------------!</span>
<a id="ln-294" name="ln-294" href="#ln-294"></a><span class="w">      </span><span class="k">call </span><span class="n">add_cross_sections</span><span class="p">(</span><span class="n">number_of_open_basis_levels</span><span class="p">,</span><span class="w">                     </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-295" name="ln-295" href="#ln-295"></a><span class="w">            </span><span class="n">partial_cross_sections_jtot</span><span class="p">,</span><span class="w"> </span><span class="n">accumulated_cross_sections</span><span class="p">)</span><span class="w"></span>
<a id="ln-296" name="ln-296" href="#ln-296"></a><span class="w">      </span><span class="c">!------------------------------------------------------------------------!</span>
<a id="ln-297" name="ln-297" href="#ln-297"></a><span class="w">      </span><span class="c">! Determine the largest partial elastic/inelastic XS in this Jtot block:</span>
<a id="ln-298" name="ln-298" href="#ln-298"></a><span class="w">      </span><span class="c">!------------------------------------------------------------------------!</span>
<a id="ln-299" name="ln-299" href="#ln-299"></a><span class="w">      </span><span class="k">call </span><span class="n">determine_largest_cross_sections</span><span class="p">(</span><span class="n">open_basis_levels</span><span class="p">,</span><span class="w">                 </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-300" name="ln-300" href="#ln-300"></a><span class="w">         </span><span class="n">partial_cross_sections_jtot</span><span class="p">,</span><span class="w"> </span><span class="n">max_elastic_cross_section</span><span class="p">,</span><span class="w">               </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-301" name="ln-301" href="#ln-301"></a><span class="w">         </span><span class="n">max_inelastic_cross_section</span><span class="p">,</span><span class="w"> </span><span class="n">max_elastic_index</span><span class="p">,</span><span class="w">                       </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-302" name="ln-302" href="#ln-302"></a><span class="w">         </span><span class="n">max_inelastic_index_1</span><span class="p">,</span><span class="w"> </span><span class="n">max_inelastic_index_2</span><span class="p">)</span><span class="w"></span>
<a id="ln-303" name="ln-303" href="#ln-303"></a><span class="w">      </span><span class="c">!------------------------------------------------------------------------!</span>
<a id="ln-304" name="ln-304" href="#ln-304"></a><span class="w">      </span><span class="k">call </span><span class="n">print_largest_partial_cross_sections</span><span class="p">(</span><span class="n">jtot_</span><span class="p">,</span><span class="w">                         </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-305" name="ln-305" href="#ln-305"></a><span class="w">         </span><span class="n">max_elastic_cross_section</span><span class="p">,</span><span class="w"> </span><span class="n">max_inelastic_cross_section</span><span class="p">,</span><span class="w">               </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-306" name="ln-306" href="#ln-306"></a><span class="w">         </span><span class="n">max_elastic_index</span><span class="p">,</span><span class="w"> </span><span class="n">max_inelastic_index_1</span><span class="p">,</span><span class="w"> </span><span class="n">max_inelastic_index_2</span><span class="p">,</span><span class="w">      </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-307" name="ln-307" href="#ln-307"></a><span class="w">         </span><span class="n">open_basis_levels</span><span class="p">)</span><span class="w"></span>
<a id="ln-308" name="ln-308" href="#ln-308"></a><span class="w">      </span><span class="c">!------------------------------------------------------------------------!</span>
<a id="ln-309" name="ln-309" href="#ln-309"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">jtotmax</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">999999</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-310" name="ln-310" href="#ln-310"></a><span class="k">         call </span><span class="n">check_cross_section_thresholds</span><span class="p">(</span><span class="n">max_elastic_cross_section</span><span class="p">,</span><span class="w">        </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-311" name="ln-311" href="#ln-311"></a><span class="w">            </span><span class="n">max_inelastic_cross_section</span><span class="p">,</span><span class="w"> </span><span class="n">consecutive_blocks_thresholddiag</span><span class="p">,</span><span class="w">     </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-312" name="ln-312" href="#ln-312"></a><span class="w">            </span><span class="n">consecutive_blocks_thresholdoff</span><span class="p">,</span><span class="w"> </span><span class="n">terminate</span><span class="p">)</span><span class="w"></span>
<a id="ln-313" name="ln-313" href="#ln-313"></a><span class="w">      </span><span class="k">endif</span><span class="w"></span>
<a id="ln-314" name="ln-314" href="#ln-314"></a><span class="w">      </span><span class="c">!------------------------------------------------------------------------!</span>
<a id="ln-315" name="ln-315" href="#ln-315"></a><span class="w">      </span><span class="c">! Check the time after each JTOT block:                                  </span>
<a id="ln-316" name="ln-316" href="#ln-316"></a><span class="w">      </span><span class="c">!------------------------------------------------------------------------!</span>
<a id="ln-317" name="ln-317" href="#ln-317"></a><span class="w">      </span><span class="k">call </span><span class="nb">cpu_time</span><span class="p">(</span><span class="n">time_jtot_stop</span><span class="p">)</span><span class="w"></span>
<a id="ln-318" name="ln-318" href="#ln-318"></a><span class="w">      </span><span class="c">!------------------------------------------------------------------------!</span>
<a id="ln-319" name="ln-319" href="#ln-319"></a><span class="w">      </span><span class="c">! Print all the XS after current JTOT block                              </span>
<a id="ln-320" name="ln-320" href="#ln-320"></a><span class="w">      </span><span class="c">!------------------------------------------------------------------------!</span>
<a id="ln-321" name="ln-321" href="#ln-321"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">prntlvl</span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-322" name="ln-322" href="#ln-322"></a><span class="k">         call </span><span class="n">print_cross_sections_for_jtot</span><span class="p">(</span><span class="n">jtot_</span><span class="p">,</span><span class="w"> </span><span class="n">open_basis_levels</span><span class="p">,</span><span class="w">          </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-323" name="ln-323" href="#ln-323"></a><span class="w">            </span><span class="n">accumulated_cross_sections</span><span class="p">)</span><span class="w"></span>
<a id="ln-324" name="ln-324" href="#ln-324"></a><span class="w">      </span><span class="k">endif</span><span class="w"></span>
<a id="ln-325" name="ln-325" href="#ln-325"></a><span class="w">      </span><span class="c">!------------------------------------------------------------------------!</span>
<a id="ln-326" name="ln-326" href="#ln-326"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">prntlvl</span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">call </span><span class="n">time_count_summary</span><span class="p">(</span><span class="n">time_jtot_start</span><span class="p">,</span><span class="w">               </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-327" name="ln-327" href="#ln-327"></a><span class="w">         </span><span class="n">time_jtot_stop</span><span class="p">,</span><span class="w"> </span><span class="n">time_jtot</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Total angular momentum block completed in &quot;</span><span class="p">)</span><span class="w"></span>
<a id="ln-328" name="ln-328" href="#ln-328"></a><span class="w">      </span><span class="c">!------------------------------------------------------------------------!</span>
<a id="ln-329" name="ln-329" href="#ln-329"></a><span class="w">      </span><span class="c">! terminate the loop if elastic_xs_threshold/inelastic_xs_threshold</span>
<a id="ln-330" name="ln-330" href="#ln-330"></a><span class="w">      </span><span class="c">! condition is satisfied</span>
<a id="ln-331" name="ln-331" href="#ln-331"></a><span class="w">      </span><span class="c">!------------------------------------------------------------------------!</span>
<a id="ln-332" name="ln-332" href="#ln-332"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">terminate</span><span class="p">)</span><span class="w"> </span><span class="k">exit</span>
<a id="ln-333" name="ln-333" href="#ln-333"></a><span class="k">   enddo</span><span class="w"></span>
<a id="ln-334" name="ln-334" href="#ln-334"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-335" name="ln-335" href="#ln-335"></a><span class="w">   </span><span class="k">call </span><span class="n">write_header</span><span class="p">(</span><span class="s2">&quot;loop_terminated&quot;</span><span class="p">)</span><span class="w"></span>
<a id="ln-336" name="ln-336" href="#ln-336"></a><span class="w">   </span><span class="k">call </span><span class="n">write_header</span><span class="p">(</span><span class="s2">&quot;summary&quot;</span><span class="p">)</span><span class="w"></span>
<a id="ln-337" name="ln-337" href="#ln-337"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-338" name="ln-338" href="#ln-338"></a><span class="w">   </span><span class="c">! if for some JTOTs the S-matrix did not fulfill the unitary check,</span>
<a id="ln-339" name="ln-339" href="#ln-339"></a><span class="w">   </span><span class="c">! these are listed here</span>
<a id="ln-340" name="ln-340" href="#ln-340"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-341" name="ln-341" href="#ln-341"></a><span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">smatcheckarr</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<a id="ln-342" name="ln-342" href="#ln-342"></a><span class="k">      call </span><span class="n">print_final_unitarity_warning</span><span class="p">(</span><span class="n">smatcheckarr</span><span class="p">)</span><span class="w"></span>
<a id="ln-343" name="ln-343" href="#ln-343"></a><span class="w">   </span><span class="k">endif</span><span class="w"></span>
<a id="ln-344" name="ln-344" href="#ln-344"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-345" name="ln-345" href="#ln-345"></a><span class="w">   </span><span class="c">! Print all the calculated XS                                                </span>
<a id="ln-346" name="ln-346" href="#ln-346"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-347" name="ln-347" href="#ln-347"></a><span class="w">   </span><span class="k">call </span><span class="n">print_final_cross_sections</span><span class="p">(</span><span class="n">open_basis_levels</span><span class="p">,</span><span class="w"> </span><span class="n">accumulated_cross_sections</span><span class="p">)</span><span class="w"></span>
<a id="ln-348" name="ln-348" href="#ln-348"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-349" name="ln-349" href="#ln-349"></a><span class="w">   </span><span class="k">call </span><span class="n">fwig_temp_free</span><span class="p">();</span><span class="w"></span>
<a id="ln-350" name="ln-350" href="#ln-350"></a><span class="w">   </span><span class="k">call </span><span class="n">fwig_table_free</span><span class="p">();</span><span class="w"></span>
<a id="ln-351" name="ln-351" href="#ln-351"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-352" name="ln-352" href="#ln-352"></a><span class="w">   </span><span class="c">! Stop the time count</span>
<a id="ln-353" name="ln-353" href="#ln-353"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-354" name="ln-354" href="#ln-354"></a><span class="w">   </span><span class="k">call </span><span class="nb">cpu_time</span><span class="p">(</span><span class="n">time_total_stop</span><span class="p">)</span><span class="w"></span>
<a id="ln-355" name="ln-355" href="#ln-355"></a><span class="w">   </span><span class="k">call </span><span class="n">time_count_summary</span><span class="p">(</span><span class="n">time_total_start</span><span class="p">,</span><span class="w"> </span><span class="n">time_total_stop</span><span class="p">,</span><span class="w"> </span><span class="n">time_total</span><span class="p">,</span><span class="w">      </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-356" name="ln-356" href="#ln-356"></a><span class="w">      </span><span class="s2">&quot;Total CPU time: &quot;</span><span class="p">)</span><span class="w"></span>
<a id="ln-357" name="ln-357" href="#ln-357"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-358" name="ln-358" href="#ln-358"></a><span class="w">   </span><span class="k">close</span><span class="p">(</span><span class="n">s_matrix_unit</span><span class="p">)</span><span class="w"></span>
<a id="ln-359" name="ln-359" href="#ln-359"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-360" name="ln-360" href="#ln-360"></a><span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">print_partial_cross_sections</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-361" name="ln-361" href="#ln-361"></a><span class="k">      close</span><span class="p">(</span><span class="n">partial_file_unit</span><span class="p">)</span><span class="w"></span>
<a id="ln-362" name="ln-362" href="#ln-362"></a><span class="w">   </span><span class="k">endif</span><span class="w"></span>
<a id="ln-363" name="ln-363" href="#ln-363"></a><span class="w">   </span><span class="c">!---------------------------------------------------------------------------!</span>
<a id="ln-364" name="ln-364" href="#ln-364"></a><span class="k">end program </span><span class="n">SCATTERING</span><span class="w"></span>
<a id="ln-365" name="ln-365" href="#ln-365"></a><span class="c">!------------------------------------------------------------------------------!</span>
<a id="ln-366" name="ln-366" href="#ln-366"></a><span class="c">!------------------------------------------------------------------------------!</span>
</pre></div>

    </section>
    </div>
  </div>

    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-6"><p>the SCATTERING code was developed by Hubert Jóźwiak<br>&copy; 2024 
</p>
        </div>
        <div class="col-xs-6 col-md-6">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
 on 2024-01-17 10:22            </p>
        </div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
  </body>
</html>